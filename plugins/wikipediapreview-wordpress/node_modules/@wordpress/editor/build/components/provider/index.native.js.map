{"version":3,"sources":["@wordpress/editor/src/components/provider/index.native.js"],"names":["postTypeEntities","name","baseURL","map","postTypeEntity","kind","transientEdits","blocks","selection","mergedEdits","meta","rawAttributes","NativeEditorProvider","Component","constructor","arguments","post","props","addEntities","receiveEntityRecords","type","getEditorSettings","settings","capabilities","maxSize","state","isHelpVisible","componentDidMount","locale","updateSettings","galleryWithImageBlocks","__unstableGalleryWithImageBlocks","getThemeColors","subscriptionParentGetHtml","serializeToNativeAction","subscriptionParentToggleHTMLMode","toggleMode","subscriptionParentSetTitle","payload","editTitle","title","subscriptionParentUpdateHtml","updateHtmlAction","html","subscriptionParentReplaceBlock","replaceBlockAction","clientId","subscriptionParentMediaAppend","blockName","mediaType","newBlock","id","mediaId","mediaUrl","indexAfterSelected","selectedBlockIndex","insertionIndex","blockCount","insertBlock","subscriptionParentUpdateEditorSettings","editorSettings","subscriptionParentUpdateCapabilities","updateCapabilitiesAction","subscriptionParentShowNotice","createSuccessNotice","message","subscriptionParentShowEditorHelp","setState","storedImpressions","impressions","NEW_BLOCK_TYPES","storedImpressionKeys","Object","keys","storedImpressionsCurrent","every","newKey","includes","componentWillUnmount","remove","colors","gradients","rawStyles","rawFeatures","componentDidUpdate","prevProps","isReady","isUnsupportedBlock","unsupportedBlockNames","filter","block","attributes","originalName","RNReactNativeGutenbergBridge","editorDidMount","mode","hasChanges","raw","content","contentInfo","characterCount","wordCount","paragraphCount","provideToNative_Html","parsed","resetEditorBlocksWithoutUndoLevel","blockClientId","replaceBlock","switchMode","clearSelectedBlock","render","children","select","__unstableIsEditorReady","isEditorReady","getEditorBlocks","getEditedPostAttribute","getEditedPostContent","getEditorMode","getBlockIndex","getSelectedBlockClientId","getGlobalBlockCount","getSettings","getBlockEditorSettings","blockEditorStore","selectedBlockClientId","dispatch","editPost","resetEditorBlocks","switchEditorMode","__unstableShouldCreateUndoLevel"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport memize from 'memize';\n\n/**\n * WordPress dependencies\n */\nimport RNReactNativeGutenbergBridge, {\n\trequestBlockTypeImpressions,\n\tsetBlockTypeImpressions,\n\tsubscribeParentGetHtml,\n\tsubscribeParentToggleHTMLMode,\n\tsubscribeUpdateHtml,\n\tsubscribeSetTitle,\n\tsubscribeMediaAppend,\n\tsubscribeReplaceBlock,\n\tsubscribeUpdateEditorSettings,\n\tsubscribeUpdateCapabilities,\n\tsubscribeShowNotice,\n\tsubscribeShowEditorHelp,\n} from '@wordpress/react-native-bridge';\nimport { Component } from '@wordpress/element';\nimport { count as wordCount } from '@wordpress/wordcount';\nimport {\n\tparse,\n\tserialize,\n\tgetUnregisteredTypeHandlerName,\n\tcreateBlock,\n} from '@wordpress/blocks';\nimport { withDispatch, withSelect } from '@wordpress/data';\nimport { compose } from '@wordpress/compose';\nimport { applyFilters } from '@wordpress/hooks';\nimport {\n\tvalidateThemeColors,\n\tvalidateThemeGradients,\n\tstore as blockEditorStore,\n} from '@wordpress/block-editor';\nimport { getGlobalStyles } from '@wordpress/components';\nimport { NEW_BLOCK_TYPES } from '@wordpress/block-library';\n\nconst postTypeEntities = [\n\t{ name: 'post', baseURL: '/wp/v2/posts' },\n\t{ name: 'page', baseURL: '/wp/v2/pages' },\n\t{ name: 'attachment', baseURL: '/wp/v2/media' },\n\t{ name: 'wp_block', baseURL: '/wp/v2/blocks' },\n].map( ( postTypeEntity ) => ( {\n\tkind: 'postType',\n\t...postTypeEntity,\n\ttransientEdits: {\n\t\tblocks: true,\n\t\tselection: true,\n\t},\n\tmergedEdits: {\n\t\tmeta: true,\n\t},\n\trawAttributes: [ 'title', 'excerpt', 'content' ],\n} ) );\nimport { EditorHelpTopics } from '@wordpress/editor';\n\n/**\n * Internal dependencies\n */\nimport EditorProvider from './index.js';\n\nclass NativeEditorProvider extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\t// Keep a local reference to `post` to detect changes\n\t\tthis.post = this.props.post;\n\t\tthis.props.addEntities( postTypeEntities );\n\t\tthis.props.receiveEntityRecords(\n\t\t\t'postType',\n\t\t\tthis.post.type,\n\t\t\tthis.post\n\t\t);\n\t\tthis.getEditorSettings = memize(\n\t\t\t( settings, capabilities ) => ( {\n\t\t\t\t...settings,\n\t\t\t\tcapabilities,\n\t\t\t} ),\n\t\t\t{\n\t\t\t\tmaxSize: 1,\n\t\t\t}\n\t\t);\n\t\tthis.state = {\n\t\t\tisHelpVisible: false,\n\t\t};\n\t}\n\n\tcomponentDidMount() {\n\t\tconst {\n\t\t\tcapabilities,\n\t\t\tlocale,\n\t\t\tupdateSettings,\n\t\t\tgalleryWithImageBlocks,\n\t\t} = this.props;\n\n\t\tupdateSettings( {\n\t\t\t...capabilities,\n\t\t\t...{ __unstableGalleryWithImageBlocks: galleryWithImageBlocks },\n\t\t\t...this.getThemeColors( this.props ),\n\t\t\tlocale,\n\t\t} );\n\n\t\tthis.subscriptionParentGetHtml = subscribeParentGetHtml( () => {\n\t\t\tthis.serializeToNativeAction();\n\t\t} );\n\n\t\tthis.subscriptionParentToggleHTMLMode = subscribeParentToggleHTMLMode(\n\t\t\t() => {\n\t\t\t\tthis.toggleMode();\n\t\t\t}\n\t\t);\n\n\t\tthis.subscriptionParentSetTitle = subscribeSetTitle( ( payload ) => {\n\t\t\tthis.props.editTitle( payload.title );\n\t\t} );\n\n\t\tthis.subscriptionParentUpdateHtml = subscribeUpdateHtml(\n\t\t\t( payload ) => {\n\t\t\t\tthis.updateHtmlAction( payload.html );\n\t\t\t}\n\t\t);\n\n\t\tthis.subscriptionParentReplaceBlock = subscribeReplaceBlock(\n\t\t\t( payload ) => {\n\t\t\t\tthis.replaceBlockAction( payload.html, payload.clientId );\n\t\t\t}\n\t\t);\n\n\t\tthis.subscriptionParentMediaAppend = subscribeMediaAppend(\n\t\t\t( payload ) => {\n\t\t\t\tconst blockName = 'core/' + payload.mediaType;\n\t\t\t\tconst newBlock = createBlock( blockName, {\n\t\t\t\t\tid: payload.mediaId,\n\t\t\t\t\t[ payload.mediaType === 'image'\n\t\t\t\t\t\t? 'url'\n\t\t\t\t\t\t: 'src' ]: payload.mediaUrl,\n\t\t\t\t} );\n\n\t\t\t\tconst indexAfterSelected = this.props.selectedBlockIndex + 1;\n\t\t\t\tconst insertionIndex =\n\t\t\t\t\tindexAfterSelected || this.props.blockCount;\n\n\t\t\t\tthis.props.insertBlock( newBlock, insertionIndex );\n\t\t\t}\n\t\t);\n\n\t\tthis.subscriptionParentUpdateEditorSettings = subscribeUpdateEditorSettings(\n\t\t\t( editorSettings ) => {\n\t\t\t\tupdateSettings( {\n\t\t\t\t\t...{\n\t\t\t\t\t\t__unstableGalleryWithImageBlocks:\n\t\t\t\t\t\t\teditorSettings.galleryWithImageBlocks,\n\t\t\t\t\t},\n\t\t\t\t\t...this.getThemeColors( editorSettings ),\n\t\t\t\t} );\n\t\t\t}\n\t\t);\n\n\t\tthis.subscriptionParentUpdateCapabilities = subscribeUpdateCapabilities(\n\t\t\t( payload ) => {\n\t\t\t\tthis.updateCapabilitiesAction( payload );\n\t\t\t}\n\t\t);\n\n\t\tthis.subscriptionParentShowNotice = subscribeShowNotice(\n\t\t\t( payload ) => {\n\t\t\t\tthis.props.createSuccessNotice( payload.message );\n\t\t\t}\n\t\t);\n\n\t\tthis.subscriptionParentShowEditorHelp = subscribeShowEditorHelp( () => {\n\t\t\tthis.setState( { isHelpVisible: true } );\n\t\t} );\n\n\t\t// Request current block impressions from native app\n\t\trequestBlockTypeImpressions( ( storedImpressions ) => {\n\t\t\tconst impressions = { ...NEW_BLOCK_TYPES, ...storedImpressions };\n\n\t\t\t// Persist impressions to JavaScript store\n\t\t\tupdateSettings( { impressions } );\n\n\t\t\t// Persist impressions to native store if they do not include latest\n\t\t\t// `NEW_BLOCK_TYPES` configuration\n\t\t\tconst storedImpressionKeys = Object.keys( storedImpressions );\n\t\t\tconst storedImpressionsCurrent = Object.keys(\n\t\t\t\tNEW_BLOCK_TYPES\n\t\t\t).every( ( newKey ) => storedImpressionKeys.includes( newKey ) );\n\t\t\tif ( ! storedImpressionsCurrent ) {\n\t\t\t\tsetBlockTypeImpressions( impressions );\n\t\t\t}\n\t\t} );\n\t}\n\n\tcomponentWillUnmount() {\n\t\tif ( this.subscriptionParentGetHtml ) {\n\t\t\tthis.subscriptionParentGetHtml.remove();\n\t\t}\n\n\t\tif ( this.subscriptionParentToggleHTMLMode ) {\n\t\t\tthis.subscriptionParentToggleHTMLMode.remove();\n\t\t}\n\n\t\tif ( this.subscriptionParentSetTitle ) {\n\t\t\tthis.subscriptionParentSetTitle.remove();\n\t\t}\n\n\t\tif ( this.subscriptionParentUpdateHtml ) {\n\t\t\tthis.subscriptionParentUpdateHtml.remove();\n\t\t}\n\n\t\tif ( this.subscriptionParentReplaceBlock ) {\n\t\t\tthis.subscriptionParentReplaceBlock.remove();\n\t\t}\n\n\t\tif ( this.subscriptionParentMediaAppend ) {\n\t\t\tthis.subscriptionParentMediaAppend.remove();\n\t\t}\n\n\t\tif ( this.subscriptionParentUpdateEditorSettings ) {\n\t\t\tthis.subscriptionParentUpdateEditorSettings.remove();\n\t\t}\n\n\t\tif ( this.subscriptionParentUpdateCapabilities ) {\n\t\t\tthis.subscriptionParentUpdateCapabilities.remove();\n\t\t}\n\n\t\tif ( this.subscriptionParentShowNotice ) {\n\t\t\tthis.subscriptionParentShowNotice.remove();\n\t\t}\n\n\t\tif ( this.subscriptionParentShowEditorHelp ) {\n\t\t\tthis.subscriptionParentShowEditorHelp.remove();\n\t\t}\n\t}\n\n\tgetThemeColors( { colors, gradients, rawStyles, rawFeatures } ) {\n\t\treturn {\n\t\t\t...( rawStyles && rawFeatures\n\t\t\t\t? getGlobalStyles( rawStyles, rawFeatures )\n\t\t\t\t: {\n\t\t\t\t\t\tcolors: validateThemeColors( colors ),\n\t\t\t\t\t\tgradients: validateThemeGradients( gradients ),\n\t\t\t\t  } ),\n\t\t};\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tif ( ! prevProps.isReady && this.props.isReady ) {\n\t\t\tconst blocks = this.props.blocks;\n\t\t\tconst isUnsupportedBlock = ( { name } ) =>\n\t\t\t\tname === getUnregisteredTypeHandlerName();\n\t\t\tconst unsupportedBlockNames = blocks\n\t\t\t\t.filter( isUnsupportedBlock )\n\t\t\t\t.map( ( block ) => block.attributes.originalName );\n\t\t\tRNReactNativeGutenbergBridge.editorDidMount(\n\t\t\t\tunsupportedBlockNames\n\t\t\t);\n\t\t}\n\t}\n\n\tserializeToNativeAction() {\n\t\tconst title = this.props.title;\n\t\tlet html;\n\n\t\tif ( this.props.mode === 'text' ) {\n\t\t\t// The HTMLTextInput component does not update the store when user is doing changes\n\t\t\t// Let's request the HTML from the component's state directly\n\t\t\thtml = applyFilters( 'native.persist-html' );\n\t\t} else {\n\t\t\thtml = serialize( this.props.blocks );\n\t\t}\n\n\t\tconst hasChanges =\n\t\t\ttitle !== this.post.title.raw || html !== this.post.content.raw;\n\n\t\t// Variable to store the content structure metrics.\n\t\tconst contentInfo = {};\n\t\tcontentInfo.characterCount = wordCount(\n\t\t\thtml,\n\t\t\t'characters_including_spaces'\n\t\t);\n\t\tcontentInfo.wordCount = wordCount( html, 'words' );\n\t\tcontentInfo.paragraphCount = this.props.paragraphCount;\n\t\tcontentInfo.blockCount = this.props.blockCount;\n\t\tRNReactNativeGutenbergBridge.provideToNative_Html(\n\t\t\thtml,\n\t\t\ttitle,\n\t\t\thasChanges,\n\t\t\tcontentInfo\n\t\t);\n\n\t\tif ( hasChanges ) {\n\t\t\tthis.post.title.raw = title;\n\t\t\tthis.post.content.raw = html;\n\t\t}\n\t}\n\n\tupdateHtmlAction( html ) {\n\t\tconst parsed = parse( html );\n\t\tthis.props.resetEditorBlocksWithoutUndoLevel( parsed );\n\t}\n\n\treplaceBlockAction( html, blockClientId ) {\n\t\tconst parsed = parse( html );\n\t\tthis.props.replaceBlock( blockClientId, parsed );\n\t}\n\n\ttoggleMode() {\n\t\tconst { mode, switchMode } = this.props;\n\t\t// refresh html content first\n\t\tthis.serializeToNativeAction();\n\t\t// make sure to blur the selected block and dismiss the keyboard\n\t\tthis.props.clearSelectedBlock();\n\t\tswitchMode( mode === 'visual' ? 'text' : 'visual' );\n\t}\n\n\tupdateCapabilitiesAction( capabilities ) {\n\t\tthis.props.updateSettings( capabilities );\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tchildren,\n\t\t\tpost, // eslint-disable-line no-unused-vars\n\t\t\tcapabilities,\n\t\t\tsettings,\n\t\t\t...props\n\t\t} = this.props;\n\t\tconst editorSettings = this.getEditorSettings( settings, capabilities );\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<EditorProvider\n\t\t\t\t\tpost={ this.post }\n\t\t\t\t\tsettings={ editorSettings }\n\t\t\t\t\t{ ...props }\n\t\t\t\t>\n\t\t\t\t\t{ children }\n\t\t\t\t</EditorProvider>\n\t\t\t\t<EditorHelpTopics\n\t\t\t\t\tisVisible={ this.state.isHelpVisible }\n\t\t\t\t\tonClose={ () => this.setState( { isHelpVisible: false } ) }\n\t\t\t\t\tclose={ () => this.setState( { isHelpVisible: false } ) }\n\t\t\t\t/>\n\t\t\t</>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select ) => {\n\t\tconst {\n\t\t\t__unstableIsEditorReady: isEditorReady,\n\t\t\tgetEditorBlocks,\n\t\t\tgetEditedPostAttribute,\n\t\t\tgetEditedPostContent,\n\t\t} = select( 'core/editor' );\n\t\tconst { getEditorMode } = select( 'core/edit-post' );\n\n\t\tconst {\n\t\t\tgetBlockIndex,\n\t\t\tgetSelectedBlockClientId,\n\t\t\tgetGlobalBlockCount,\n\t\t\tgetSettings: getBlockEditorSettings,\n\t\t} = select( blockEditorStore );\n\n\t\tconst selectedBlockClientId = getSelectedBlockClientId();\n\t\treturn {\n\t\t\tmode: getEditorMode(),\n\t\t\tisReady: isEditorReady(),\n\t\t\tblocks: getEditorBlocks(),\n\t\t\ttitle: getEditedPostAttribute( 'title' ),\n\t\t\tgetEditedPostContent,\n\t\t\tgetBlockEditorSettings,\n\t\t\tselectedBlockIndex: getBlockIndex( selectedBlockClientId ),\n\t\t\tblockCount: getGlobalBlockCount(),\n\t\t\tparagraphCount: getGlobalBlockCount( 'core/paragraph' ),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst { editPost, resetEditorBlocks } = dispatch( 'core/editor' );\n\t\tconst {\n\t\t\tupdateSettings,\n\t\t\tclearSelectedBlock,\n\t\t\tinsertBlock,\n\t\t\treplaceBlock,\n\t\t} = dispatch( blockEditorStore );\n\t\tconst { switchEditorMode } = dispatch( 'core/edit-post' );\n\t\tconst { addEntities, receiveEntityRecords } = dispatch( 'core' );\n\t\tconst { createSuccessNotice } = dispatch( 'core/notices' );\n\n\t\treturn {\n\t\t\tupdateSettings,\n\t\t\taddEntities,\n\t\t\tclearSelectedBlock,\n\t\t\tinsertBlock,\n\t\t\tcreateSuccessNotice,\n\t\t\teditTitle( title ) {\n\t\t\t\teditPost( { title } );\n\t\t\t},\n\t\t\treceiveEntityRecords,\n\t\t\tresetEditorBlocksWithoutUndoLevel( blocks ) {\n\t\t\t\tresetEditorBlocks( blocks, {\n\t\t\t\t\t__unstableShouldCreateUndoLevel: false,\n\t\t\t\t} );\n\t\t\t},\n\t\t\tswitchMode( mode ) {\n\t\t\t\tswitchEditorMode( mode );\n\t\t\t},\n\t\t\treplaceBlock,\n\t\t};\n\t} ),\n] )( NativeEditorProvider );\n"]}