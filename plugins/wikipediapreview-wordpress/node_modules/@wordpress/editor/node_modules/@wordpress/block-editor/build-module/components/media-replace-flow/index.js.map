{"version":3,"sources":["@wordpress/block-editor/src/components/media-replace-flow/index.js"],"names":["uniqueId","noop","useState","createRef","renderToString","__","speak","FormFileUpload","NavigableMenu","MenuItem","ToolbarButton","Dropdown","withFilters","withDispatch","useSelect","DOWN","compose","upload","media","mediaIcon","store","noticesStore","MediaUpload","MediaUploadCheck","LinkControl","blockEditorStore","MediaReplaceFlow","mediaURL","mediaId","allowedTypes","accept","onSelect","onSelectURL","onFilesUpload","name","createNotice","removeNotice","mediaURLValue","setMediaURLValue","mediaUpload","select","getSettings","editMediaButtonRef","errorNoticeID","onError","message","errorElement","document","createElement","innerHTML","renderMsg","textContent","innerText","setTimeout","id","isDismissible","selectMedia","url","selectURL","newURL","uploadFiles","event","files","target","setMedia","filesList","onFileChange","openOnArrowDown","keyCode","preventDefault","click","POPOVER_PROPS","isAlternate","isOpen","onToggle","onClose","open","openFileDialog","current","focus","dispatch"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { uniqueId, noop } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { useState, createRef, renderToString } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport { speak } from '@wordpress/a11y';\nimport {\n\tFormFileUpload,\n\tNavigableMenu,\n\tMenuItem,\n\tToolbarButton,\n\tDropdown,\n\twithFilters,\n} from '@wordpress/components';\nimport { withDispatch, useSelect } from '@wordpress/data';\nimport { DOWN } from '@wordpress/keycodes';\nimport { compose } from '@wordpress/compose';\nimport { upload, media as mediaIcon } from '@wordpress/icons';\nimport { store as noticesStore } from '@wordpress/notices';\n\n/**\n * Internal dependencies\n */\nimport MediaUpload from '../media-upload';\nimport MediaUploadCheck from '../media-upload/check';\nimport LinkControl from '../link-control';\nimport { store as blockEditorStore } from '../../store';\n\nconst MediaReplaceFlow = ( {\n\tmediaURL,\n\tmediaId,\n\tallowedTypes,\n\taccept,\n\tonSelect,\n\tonSelectURL,\n\tonFilesUpload = noop,\n\tname = __( 'Replace' ),\n\tcreateNotice,\n\tremoveNotice,\n} ) => {\n\tconst [ mediaURLValue, setMediaURLValue ] = useState( mediaURL );\n\tconst mediaUpload = useSelect( ( select ) => {\n\t\treturn select( blockEditorStore ).getSettings().mediaUpload;\n\t}, [] );\n\tconst editMediaButtonRef = createRef();\n\tconst errorNoticeID = uniqueId(\n\t\t'block-editor/media-replace-flow/error-notice/'\n\t);\n\n\tconst onError = ( message ) => {\n\t\tconst errorElement = document.createElement( 'div' );\n\t\terrorElement.innerHTML = renderToString( message );\n\t\t// The default error contains some HTML that,\n\t\t// for example, makes the filename bold.\n\t\t// The notice, by default, accepts strings only and so\n\t\t// we need to remove the html from the error.\n\t\tconst renderMsg =\n\t\t\terrorElement.textContent || errorElement.innerText || '';\n\t\t// We need to set a timeout for showing the notice\n\t\t// so that VoiceOver and possibly other screen readers\n\t\t// can announce the error afer the toolbar button\n\t\t// regains focus once the upload dialog closes.\n\t\t// Otherwise VO simply skips over the notice and announces\n\t\t// the focused element and the open menu.\n\t\tsetTimeout( () => {\n\t\t\tcreateNotice( 'error', renderMsg, {\n\t\t\t\tspeak: true,\n\t\t\t\tid: errorNoticeID,\n\t\t\t\tisDismissible: true,\n\t\t\t} );\n\t\t}, 1000 );\n\t};\n\n\tconst selectMedia = ( media ) => {\n\t\tsetMediaURLValue( media.url );\n\t\t// Calling `onSelect` after the state update since it might unmount the component.\n\t\tonSelect( media );\n\t\tspeak( __( 'The media file has been replaced' ) );\n\t\tremoveNotice( errorNoticeID );\n\t};\n\n\tconst selectURL = ( newURL ) => {\n\t\tonSelectURL( newURL );\n\t};\n\n\tconst uploadFiles = ( event ) => {\n\t\tconst files = event.target.files;\n\t\tonFilesUpload( files );\n\t\tconst setMedia = ( [ media ] ) => {\n\t\t\tselectMedia( media );\n\t\t};\n\t\tmediaUpload( {\n\t\t\tallowedTypes,\n\t\t\tfilesList: files,\n\t\t\tonFileChange: setMedia,\n\t\t\tonError,\n\t\t} );\n\t};\n\n\tconst openOnArrowDown = ( event ) => {\n\t\tif ( event.keyCode === DOWN ) {\n\t\t\tevent.preventDefault();\n\t\t\tevent.target.click();\n\t\t}\n\t};\n\n\tconst POPOVER_PROPS = {\n\t\tisAlternate: true,\n\t};\n\n\treturn (\n\t\t<Dropdown\n\t\t\tpopoverProps={ POPOVER_PROPS }\n\t\t\tcontentClassName=\"block-editor-media-replace-flow__options\"\n\t\t\trenderToggle={ ( { isOpen, onToggle } ) => (\n\t\t\t\t<ToolbarButton\n\t\t\t\t\tref={ editMediaButtonRef }\n\t\t\t\t\taria-expanded={ isOpen }\n\t\t\t\t\taria-haspopup=\"true\"\n\t\t\t\t\tonClick={ onToggle }\n\t\t\t\t\tonKeyDown={ openOnArrowDown }\n\t\t\t\t>\n\t\t\t\t\t{ name }\n\t\t\t\t</ToolbarButton>\n\t\t\t) }\n\t\t\trenderContent={ ( { onClose } ) => (\n\t\t\t\t<>\n\t\t\t\t\t<NavigableMenu className=\"block-editor-media-replace-flow__media-upload-menu\">\n\t\t\t\t\t\t<MediaUpload\n\t\t\t\t\t\t\tvalue={ mediaId }\n\t\t\t\t\t\t\tonSelect={ ( media ) => selectMedia( media ) }\n\t\t\t\t\t\t\tallowedTypes={ allowedTypes }\n\t\t\t\t\t\t\trender={ ( { open } ) => (\n\t\t\t\t\t\t\t\t<MenuItem icon={ mediaIcon } onClick={ open }>\n\t\t\t\t\t\t\t\t\t{ __( 'Open Media Library' ) }\n\t\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<MediaUploadCheck>\n\t\t\t\t\t\t\t<FormFileUpload\n\t\t\t\t\t\t\t\tonChange={ ( event ) => {\n\t\t\t\t\t\t\t\t\tuploadFiles( event, onClose );\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\taccept={ accept }\n\t\t\t\t\t\t\t\trender={ ( { openFileDialog } ) => {\n\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\t\t\t\ticon={ upload }\n\t\t\t\t\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\t\t\t\t\topenFileDialog();\n\t\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{ __( 'Upload' ) }\n\t\t\t\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</MediaUploadCheck>\n\t\t\t\t\t</NavigableMenu>\n\t\t\t\t\t{ onSelectURL && (\n\t\t\t\t\t\t// eslint-disable-next-line jsx-a11y/no-noninteractive-element-interactions\n\t\t\t\t\t\t<form className=\"block-editor-media-flow__url-input\">\n\t\t\t\t\t\t\t<span className=\"block-editor-media-replace-flow__image-url-label\">\n\t\t\t\t\t\t\t\t{ __( 'Current media URL:' ) }\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<LinkControl\n\t\t\t\t\t\t\t\tvalue={ { url: mediaURLValue } }\n\t\t\t\t\t\t\t\tsettings={ [] }\n\t\t\t\t\t\t\t\tshowSuggestions={ false }\n\t\t\t\t\t\t\t\tonChange={ ( { url } ) => {\n\t\t\t\t\t\t\t\t\tsetMediaURLValue( url );\n\t\t\t\t\t\t\t\t\tselectURL( url );\n\t\t\t\t\t\t\t\t\teditMediaButtonRef.current.focus();\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</form>\n\t\t\t\t\t) }\n\t\t\t\t</>\n\t\t\t) }\n\t\t/>\n\t);\n};\n\nexport default compose( [\n\twithDispatch( ( dispatch ) => {\n\t\tconst { createNotice, removeNotice } = dispatch( noticesStore );\n\t\treturn {\n\t\t\tcreateNotice,\n\t\t\tremoveNotice,\n\t\t};\n\t} ),\n\twithFilters( 'editor.MediaReplaceFlow' ),\n] )( MediaReplaceFlow );\n"]}