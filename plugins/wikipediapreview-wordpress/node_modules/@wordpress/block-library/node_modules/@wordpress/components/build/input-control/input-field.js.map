{"version":3,"sources":["@wordpress/components/src/input-control/input-field.tsx"],"names":["InputField","disabled","dragDirection","dragThreshold","id","isDragEnabled","isFocused","isPressEnterToChange","onBlur","noop","onChange","onDrag","onDragEnd","onDragStart","onFocus","onKeyDown","onValidate","size","setIsFocused","stateReducer","state","value","valueProp","type","props","ref","change","commit","drag","dragEnd","dragStart","invalidate","pressDown","pressEnter","pressUp","reset","update","_event","isDragging","isDirty","wasDirtyOnBlur","dragCursor","current","event","handleOnBlur","handleOnCommit","handleOnFocus","handleOnChange","nextValue","target","currentTarget","err","handleOnKeyDown","keyCode","UP","DOWN","ENTER","preventDefault","dragGestureProps","dragProps","distance","dragging","persist","stopPropagation","threshold","enabled","handleOnMouseDown","onMouseDown","ownerDocument","activeElement","focus","ForwardedComponent"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { noop } from 'lodash';\nimport { useDrag } from 'react-use-gesture';\n// eslint-disable-next-line no-restricted-imports\nimport type {\n\tSyntheticEvent,\n\tChangeEvent,\n\tKeyboardEvent,\n\tPointerEvent,\n\tFocusEvent,\n\tRef,\n\tMouseEvent,\n} from 'react';\n\n/**\n * WordPress dependencies\n */\nimport { forwardRef, useRef } from '@wordpress/element';\nimport { UP, DOWN, ENTER } from '@wordpress/keycodes';\n/**\n * Internal dependencies\n */\nimport type { WordPressComponentProps } from '../ui/context';\nimport { useDragCursor } from './utils';\nimport { Input } from './styles/input-control-styles';\nimport { useInputControlStateReducer } from './reducer/reducer';\nimport { isValueEmpty } from '../utils/values';\nimport { useUpdateEffect } from '../utils';\nimport type { InputFieldProps } from './types';\n\nfunction InputField(\n\t{\n\t\tdisabled = false,\n\t\tdragDirection = 'n',\n\t\tdragThreshold = 10,\n\t\tid,\n\t\tisDragEnabled = false,\n\t\tisFocused,\n\t\tisPressEnterToChange = false,\n\t\tonBlur = noop,\n\t\tonChange = noop,\n\t\tonDrag = noop,\n\t\tonDragEnd = noop,\n\t\tonDragStart = noop,\n\t\tonFocus = noop,\n\t\tonKeyDown = noop,\n\t\tonValidate = noop,\n\t\tsize = 'default',\n\t\tsetIsFocused,\n\t\tstateReducer = ( state: any ) => state,\n\t\tvalue: valueProp,\n\t\ttype,\n\t\t...props\n\t}: WordPressComponentProps< InputFieldProps, 'input', false >,\n\tref: Ref< HTMLInputElement >\n) {\n\tconst {\n\t\t// State\n\t\tstate,\n\t\t// Actions\n\t\tchange,\n\t\tcommit,\n\t\tdrag,\n\t\tdragEnd,\n\t\tdragStart,\n\t\tinvalidate,\n\t\tpressDown,\n\t\tpressEnter,\n\t\tpressUp,\n\t\treset,\n\t\tupdate,\n\t} = useInputControlStateReducer( stateReducer, {\n\t\tisDragEnabled,\n\t\tvalue: valueProp,\n\t\tisPressEnterToChange,\n\t} );\n\n\tconst { _event, value, isDragging, isDirty } = state;\n\tconst wasDirtyOnBlur = useRef( false );\n\n\tconst dragCursor = useDragCursor( isDragging, dragDirection );\n\n\t/*\n\t * Handles synchronization of external and internal value state.\n\t * If not focused and did not hold a dirty value[1] on blur\n\t * updates the value from the props. Otherwise if not holding\n\t * a dirty value[1] propagates the value and event through onChange.\n\t * [1] value is only made dirty if isPressEnterToChange is true\n\t */\n\tuseUpdateEffect( () => {\n\t\tif ( valueProp === value ) {\n\t\t\treturn;\n\t\t}\n\t\tif ( ! isFocused && ! wasDirtyOnBlur.current ) {\n\t\t\tupdate( valueProp, _event as SyntheticEvent );\n\t\t} else if ( ! isDirty ) {\n\t\t\tonChange( value, {\n\t\t\t\tevent: _event as ChangeEvent< HTMLInputElement >,\n\t\t\t} );\n\t\t\twasDirtyOnBlur.current = false;\n\t\t}\n\t}, [ value, isDirty, isFocused, valueProp ] );\n\n\tconst handleOnBlur = ( event: FocusEvent< HTMLInputElement > ) => {\n\t\tonBlur( event );\n\t\tsetIsFocused?.( false );\n\n\t\t/**\n\t\t * If isPressEnterToChange is set, this commits the value to\n\t\t * the onChange callback.\n\t\t */\n\t\tif ( isPressEnterToChange && isDirty ) {\n\t\t\twasDirtyOnBlur.current = true;\n\t\t\tif ( ! isValueEmpty( value ) ) {\n\t\t\t\thandleOnCommit( event );\n\t\t\t} else {\n\t\t\t\treset( valueProp, event );\n\t\t\t}\n\t\t}\n\t};\n\n\tconst handleOnFocus = ( event: FocusEvent< HTMLInputElement > ) => {\n\t\tonFocus( event );\n\t\tsetIsFocused?.( true );\n\t};\n\n\tconst handleOnChange = ( event: ChangeEvent< HTMLInputElement > ) => {\n\t\tconst nextValue = event.target.value;\n\t\tchange( nextValue, event );\n\t};\n\n\tconst handleOnCommit = ( event: SyntheticEvent< HTMLInputElement > ) => {\n\t\tconst nextValue = event.currentTarget.value;\n\n\t\ttry {\n\t\t\tonValidate( nextValue );\n\t\t\tcommit( nextValue, event );\n\t\t} catch ( err ) {\n\t\t\tinvalidate( err, event );\n\t\t}\n\t};\n\n\tconst handleOnKeyDown = ( event: KeyboardEvent< HTMLInputElement > ) => {\n\t\tconst { keyCode } = event;\n\t\tonKeyDown( event );\n\n\t\tswitch ( keyCode ) {\n\t\t\tcase UP:\n\t\t\t\tpressUp( event );\n\t\t\t\tbreak;\n\n\t\t\tcase DOWN:\n\t\t\t\tpressDown( event );\n\t\t\t\tbreak;\n\n\t\t\tcase ENTER:\n\t\t\t\tpressEnter( event );\n\n\t\t\t\tif ( isPressEnterToChange ) {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\thandleOnCommit( event );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tconst dragGestureProps = useDrag< PointerEvent< HTMLInputElement > >(\n\t\t( dragProps ) => {\n\t\t\tconst { distance, dragging, event } = dragProps;\n\t\t\t// The event is persisted to prevent errors in components using this\n\t\t\t// to check if a modifier key was held while dragging.\n\t\t\tevent.persist();\n\n\t\t\tif ( ! distance ) return;\n\t\t\tevent.stopPropagation();\n\n\t\t\t/**\n\t\t\t * Quick return if no longer dragging.\n\t\t\t * This prevents unnecessary value calculations.\n\t\t\t */\n\t\t\tif ( ! dragging ) {\n\t\t\t\tonDragEnd( dragProps );\n\t\t\t\tdragEnd( dragProps );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tonDrag( dragProps );\n\t\t\tdrag( dragProps );\n\n\t\t\tif ( ! isDragging ) {\n\t\t\t\tonDragStart( dragProps );\n\t\t\t\tdragStart( dragProps );\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tthreshold: dragThreshold,\n\t\t\tenabled: isDragEnabled,\n\t\t}\n\t);\n\n\tconst dragProps = isDragEnabled ? dragGestureProps() : {};\n\t/*\n\t * Works around the odd UA (e.g. Firefox) that does not focus inputs of\n\t * type=number when their spinner arrows are pressed.\n\t */\n\tlet handleOnMouseDown;\n\tif ( type === 'number' ) {\n\t\thandleOnMouseDown = ( event: MouseEvent< HTMLInputElement > ) => {\n\t\t\tprops.onMouseDown?.( event );\n\t\t\tif (\n\t\t\t\tevent.currentTarget !==\n\t\t\t\tevent.currentTarget.ownerDocument.activeElement\n\t\t\t) {\n\t\t\t\tevent.currentTarget.focus();\n\t\t\t}\n\t\t};\n\t}\n\n\treturn (\n\t\t<Input\n\t\t\t{ ...props }\n\t\t\t{ ...dragProps }\n\t\t\tclassName=\"components-input-control__input\"\n\t\t\tdisabled={ disabled }\n\t\t\tdragCursor={ dragCursor }\n\t\t\tisDragging={ isDragging }\n\t\t\tid={ id }\n\t\t\tonBlur={ handleOnBlur }\n\t\t\tonChange={ handleOnChange }\n\t\t\tonFocus={ handleOnFocus }\n\t\t\tonKeyDown={ handleOnKeyDown }\n\t\t\tonMouseDown={ handleOnMouseDown }\n\t\t\tref={ ref }\n\t\t\tinputSize={ size }\n\t\t\tvalue={ value }\n\t\t\ttype={ type }\n\t\t/>\n\t);\n}\n\nconst ForwardedComponent = forwardRef( InputField );\n\nexport default ForwardedComponent;\n"]}