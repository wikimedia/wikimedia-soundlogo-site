{"version":3,"sources":["@wordpress/rich-text/src/component/index.js"],"names":["useRichText","value","selectionStart","selectionEnd","placeholder","preserveWhiteSpace","onSelectionChange","onChange","__unstableMultilineTag","multilineTag","__unstableDisableFormats","disableFormats","__unstableIsSelected","isSelected","__unstableDependencies","__unstableAfterParse","__unstableBeforeSerialize","__unstableAddInvisibleFormats","registry","forceRender","ref","createRecord","ownerDocument","defaultView","current","selection","getSelection","range","rangeCount","getRangeAt","element","multilineWrapperTags","undefined","__unstableIsEditableTree","applyRecord","newRecord","domOnly","prepareEditableTree","__unstableDomOnly","_value","record","setRecordFromProps","html","formats","Array","length","replacements","start","end","hadSelectionUpdate","handleChange","text","batch","__unstableFormats","__unstableText","applyFromProps","didMount","mergedRefs","__experimentalRichText"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useRef, useLayoutEffect, useReducer } from '@wordpress/element';\nimport { useMergeRefs, useRefEffect } from '@wordpress/compose';\nimport { useRegistry } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport { create } from '../create';\nimport { apply } from '../to-dom';\nimport { toHTMLString } from '../to-html-string';\nimport { useDefaultStyle } from './use-default-style';\nimport { useBoundaryStyle } from './use-boundary-style';\nimport { useCopyHandler } from './use-copy-handler';\nimport { useFormatBoundaries } from './use-format-boundaries';\nimport { useSelectObject } from './use-select-object';\nimport { useIndentListItemOnSpace } from './use-indent-list-item-on-space';\nimport { useInputAndSelection } from './use-input-and-selection';\nimport { useDelete } from './use-delete';\nimport { useSpace } from './use-space';\n\nexport function useRichText( {\n\tvalue = '',\n\tselectionStart,\n\tselectionEnd,\n\tplaceholder,\n\tpreserveWhiteSpace,\n\tonSelectionChange,\n\tonChange,\n\t__unstableMultilineTag: multilineTag,\n\t__unstableDisableFormats: disableFormats,\n\t__unstableIsSelected: isSelected,\n\t__unstableDependencies = [],\n\t__unstableAfterParse,\n\t__unstableBeforeSerialize,\n\t__unstableAddInvisibleFormats,\n} ) {\n\tconst registry = useRegistry();\n\tconst [ , forceRender ] = useReducer( () => ( {} ) );\n\tconst ref = useRef();\n\n\tfunction createRecord() {\n\t\tconst {\n\t\t\townerDocument: { defaultView },\n\t\t} = ref.current;\n\t\tconst selection = defaultView.getSelection();\n\t\tconst range =\n\t\t\tselection.rangeCount > 0 ? selection.getRangeAt( 0 ) : null;\n\n\t\treturn create( {\n\t\t\telement: ref.current,\n\t\t\trange,\n\t\t\tmultilineTag,\n\t\t\tmultilineWrapperTags:\n\t\t\t\tmultilineTag === 'li' ? [ 'ul', 'ol' ] : undefined,\n\t\t\t__unstableIsEditableTree: true,\n\t\t\tpreserveWhiteSpace,\n\t\t} );\n\t}\n\n\tfunction applyRecord( newRecord, { domOnly } = {} ) {\n\t\tapply( {\n\t\t\tvalue: newRecord,\n\t\t\tcurrent: ref.current,\n\t\t\tmultilineTag,\n\t\t\tmultilineWrapperTags:\n\t\t\t\tmultilineTag === 'li' ? [ 'ul', 'ol' ] : undefined,\n\t\t\tprepareEditableTree: __unstableAddInvisibleFormats,\n\t\t\t__unstableDomOnly: domOnly,\n\t\t\tplaceholder,\n\t\t} );\n\t}\n\n\t// Internal values are updated synchronously, unlike props and state.\n\tconst _value = useRef( value );\n\tconst record = useRef();\n\n\tfunction setRecordFromProps() {\n\t\t_value.current = value;\n\t\trecord.current = create( {\n\t\t\thtml: value,\n\t\t\tmultilineTag,\n\t\t\tmultilineWrapperTags:\n\t\t\t\tmultilineTag === 'li' ? [ 'ul', 'ol' ] : undefined,\n\t\t\tpreserveWhiteSpace,\n\t\t} );\n\t\tif ( disableFormats ) {\n\t\t\trecord.current.formats = Array( value.length );\n\t\t\trecord.current.replacements = Array( value.length );\n\t\t}\n\t\tif ( __unstableAfterParse ) {\n\t\t\trecord.current.formats = __unstableAfterParse( record.current );\n\t\t}\n\t\trecord.current.start = selectionStart;\n\t\trecord.current.end = selectionEnd;\n\t}\n\n\tconst hadSelectionUpdate = useRef( false );\n\n\tif ( ! record.current ) {\n\t\tsetRecordFromProps();\n\t} else if (\n\t\tselectionStart !== record.current.start ||\n\t\tselectionEnd !== record.current.end\n\t) {\n\t\thadSelectionUpdate.current = isSelected;\n\t\trecord.current = {\n\t\t\t...record.current,\n\t\t\tstart: selectionStart,\n\t\t\tend: selectionEnd,\n\t\t};\n\t}\n\n\t/**\n\t * Sync the value to global state. The node tree and selection will also be\n\t * updated if differences are found.\n\t *\n\t * @param {Object} newRecord The record to sync and apply.\n\t */\n\tfunction handleChange( newRecord ) {\n\t\trecord.current = newRecord;\n\t\tapplyRecord( newRecord );\n\n\t\tif ( disableFormats ) {\n\t\t\t_value.current = newRecord.text;\n\t\t} else {\n\t\t\t_value.current = toHTMLString( {\n\t\t\t\tvalue: __unstableBeforeSerialize\n\t\t\t\t\t? {\n\t\t\t\t\t\t\t...newRecord,\n\t\t\t\t\t\t\tformats: __unstableBeforeSerialize( newRecord ),\n\t\t\t\t\t  }\n\t\t\t\t\t: newRecord,\n\t\t\t\tmultilineTag,\n\t\t\t\tpreserveWhiteSpace,\n\t\t\t} );\n\t\t}\n\n\t\tconst { start, end, formats, text } = newRecord;\n\n\t\t// Selection must be updated first, so it is recorded in history when\n\t\t// the content change happens.\n\t\t// We batch both calls to only attempt to rerender once.\n\t\tregistry.batch( () => {\n\t\t\tonSelectionChange( start, end );\n\t\t\tonChange( _value.current, {\n\t\t\t\t__unstableFormats: formats,\n\t\t\t\t__unstableText: text,\n\t\t\t} );\n\t\t} );\n\t\tforceRender();\n\t}\n\n\tfunction applyFromProps() {\n\t\tsetRecordFromProps();\n\t\tapplyRecord( record.current );\n\t}\n\n\tconst didMount = useRef( false );\n\n\t// Value updates must happen synchonously to avoid overwriting newer values.\n\tuseLayoutEffect( () => {\n\t\tif ( didMount.current && value !== _value.current ) {\n\t\t\tapplyFromProps();\n\t\t}\n\t}, [ value ] );\n\n\t// Value updates must happen synchonously to avoid overwriting newer values.\n\tuseLayoutEffect( () => {\n\t\tif ( ! hadSelectionUpdate.current ) {\n\t\t\treturn;\n\t\t}\n\n\t\tapplyFromProps();\n\t\thadSelectionUpdate.current = false;\n\t}, [ hadSelectionUpdate.current ] );\n\n\tconst mergedRefs = useMergeRefs( [\n\t\tref,\n\t\tuseDefaultStyle(),\n\t\tuseBoundaryStyle( { record } ),\n\t\tuseCopyHandler( { record, multilineTag, preserveWhiteSpace } ),\n\t\tuseSelectObject(),\n\t\tuseFormatBoundaries( { record, applyRecord } ),\n\t\tuseDelete( {\n\t\t\tcreateRecord,\n\t\t\thandleChange,\n\t\t\tmultilineTag,\n\t\t} ),\n\t\tuseIndentListItemOnSpace( {\n\t\t\tmultilineTag,\n\t\t\tcreateRecord,\n\t\t\thandleChange,\n\t\t} ),\n\t\tuseInputAndSelection( {\n\t\t\trecord,\n\t\t\tapplyRecord,\n\t\t\tcreateRecord,\n\t\t\thandleChange,\n\t\t\tisSelected,\n\t\t\tonSelectionChange,\n\t\t} ),\n\t\tuseSpace(),\n\t\tuseRefEffect( () => {\n\t\t\tapplyFromProps();\n\t\t\tdidMount.current = true;\n\t\t}, [ placeholder, ...__unstableDependencies ] ),\n\t] );\n\n\treturn {\n\t\tvalue: record.current,\n\t\tonChange: handleChange,\n\t\tref: mergedRefs,\n\t};\n}\n\nexport default function __experimentalRichText() {}\n"]}