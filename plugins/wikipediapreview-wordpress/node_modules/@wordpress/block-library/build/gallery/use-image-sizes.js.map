{"version":3,"sources":["@wordpress/block-library/src/gallery/use-image-sizes.js"],"names":["useImageSizes","images","isSelected","getSettings","getImageSizing","length","imageSizes","resizedImages","reduce","currentResizedImages","img","id","sizes","currentSizes","size","defaultUrl","slug","mediaDetailsUrl","parseInt","filter","map","name","value","label"],"mappings":";;;;;;;AAGA;;AAKA;;AARA;AACA;AACA;;AAGA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACe,SAASA,aAAT,CAAwBC,MAAxB,EAAgCC,UAAhC,EAA4CC,WAA5C,EAA0D;AACxE,SAAO,sBAAS,MAAMC,cAAc,EAA7B,EAAiC,CAAEH,MAAF,EAAUC,UAAV,CAAjC,CAAP;;AAEA,WAASE,cAAT,GAA0B;AACzB,QAAK,CAAEH,MAAF,IAAYA,MAAM,CAACI,MAAP,KAAkB,CAAnC,EAAuC;AACtC;AACA;;AACD,UAAM;AAAEC,MAAAA;AAAF,QAAiBH,WAAW,EAAlC;AACA,QAAII,aAAa,GAAG,EAApB;;AAEA,QAAKL,UAAL,EAAkB;AACjBK,MAAAA,aAAa,GAAGN,MAAM,CAACO,MAAP,CAAe,CAAEC,oBAAF,EAAwBC,GAAxB,KAAiC;AAC/D,YAAK,CAAEA,GAAG,CAACC,EAAX,EAAgB;AACf,iBAAOF,oBAAP;AACA;;AAED,cAAMG,KAAK,GAAGN,UAAU,CAACE,MAAX,CAAmB,CAAEK,YAAF,EAAgBC,IAAhB,KAA0B;AAC1D,gBAAMC,UAAU,GAAG,iBAAKL,GAAL,EAAU,CAC5B,OAD4B,EAE5BI,IAAI,CAACE,IAFuB,EAG5B,KAH4B,CAAV,CAAnB;AAKA,gBAAMC,eAAe,GAAG,iBAAKP,GAAL,EAAU,CACjC,eADiC,EAEjC,OAFiC,EAGjCI,IAAI,CAACE,IAH4B,EAIjC,YAJiC,CAAV,CAAxB;AAMA,iBAAO,EACN,GAAGH,YADG;AAEN,aAAEC,IAAI,CAACE,IAAP,GAAeD,UAAU,IAAIE;AAFvB,WAAP;AAIA,SAhBa,EAgBX,EAhBW,CAAd;AAiBA,eAAO,EACN,GAAGR,oBADG;AAEN,WAAES,QAAQ,CAAER,GAAG,CAACC,EAAN,EAAU,EAAV,CAAV,GAA4BC;AAFtB,SAAP;AAIA,OA1Be,EA0Bb,EA1Ba,CAAhB;AA2BA;;AACD,WAAON,UAAU,CACfa,MADK,CACG,CAAE;AAAEH,MAAAA;AAAF,KAAF,KACR,kBAAMT,aAAN,EAAuBK,KAAF,IAAaA,KAAK,CAAEI,IAAF,CAAvC,CAFK,EAILI,GAJK,CAIA,CAAE;AAAEC,MAAAA,IAAF;AAAQL,MAAAA;AAAR,KAAF,MAAwB;AAAEM,MAAAA,KAAK,EAAEN,IAAT;AAAeO,MAAAA,KAAK,EAAEF;AAAtB,KAAxB,CAJA,CAAP;AAKA;AACD","sourcesContent":["/**\n * External dependencies\n */\nimport { get, some } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { useMemo } from '@wordpress/element';\n\n/**\n * Calculates the image sizes that are avaible for the current gallery images in order to\n * populate the 'Image size' selector.\n *\n * @param {Array}    images      Basic image block data taken from current gallery innerBlock\n * @param {boolean}  isSelected  Is the block currently selected in the editor.\n * @param {Function} getSettings Block editor store selector.\n *\n * @return {Array} An array of image size options.\n */\nexport default function useImageSizes( images, isSelected, getSettings ) {\n\treturn useMemo( () => getImageSizing(), [ images, isSelected ] );\n\n\tfunction getImageSizing() {\n\t\tif ( ! images || images.length === 0 ) {\n\t\t\treturn;\n\t\t}\n\t\tconst { imageSizes } = getSettings();\n\t\tlet resizedImages = {};\n\n\t\tif ( isSelected ) {\n\t\t\tresizedImages = images.reduce( ( currentResizedImages, img ) => {\n\t\t\t\tif ( ! img.id ) {\n\t\t\t\t\treturn currentResizedImages;\n\t\t\t\t}\n\n\t\t\t\tconst sizes = imageSizes.reduce( ( currentSizes, size ) => {\n\t\t\t\t\tconst defaultUrl = get( img, [\n\t\t\t\t\t\t'sizes',\n\t\t\t\t\t\tsize.slug,\n\t\t\t\t\t\t'url',\n\t\t\t\t\t] );\n\t\t\t\t\tconst mediaDetailsUrl = get( img, [\n\t\t\t\t\t\t'media_details',\n\t\t\t\t\t\t'sizes',\n\t\t\t\t\t\tsize.slug,\n\t\t\t\t\t\t'source_url',\n\t\t\t\t\t] );\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...currentSizes,\n\t\t\t\t\t\t[ size.slug ]: defaultUrl || mediaDetailsUrl,\n\t\t\t\t\t};\n\t\t\t\t}, {} );\n\t\t\t\treturn {\n\t\t\t\t\t...currentResizedImages,\n\t\t\t\t\t[ parseInt( img.id, 10 ) ]: sizes,\n\t\t\t\t};\n\t\t\t}, {} );\n\t\t}\n\t\treturn imageSizes\n\t\t\t.filter( ( { slug } ) =>\n\t\t\t\tsome( resizedImages, ( sizes ) => sizes[ slug ] )\n\t\t\t)\n\t\t\t.map( ( { name, slug } ) => ( { value: slug, label: name } ) );\n\t}\n}\n"]}