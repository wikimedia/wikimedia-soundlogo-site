{"version":3,"sources":["@wordpress/block-library/src/post-featured-image/edit.js"],"names":["ALLOWED_MEDIA_TYPES","placeholderChip","postFeaturedImage","PostFeaturedImageDisplay","attributes","setAttributes","context","postId","postType","queryId","noticeUI","noticeOperations","isDescendentOfQueryLoop","isLink","height","width","scale","featuredImage","setFeaturedImage","media","select","coreStore","getMedia","blockProps","style","onSelectImage","value","id","onUploadError","message","removeAllNotices","createErrorNotice","image","title","instructions","source_url","alt_text","objectFit","PostFeaturedImageWithNotices","PostFeaturedImageEdit","props"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useEntityProp, store as coreStore } from '@wordpress/core-data';\nimport { useSelect } from '@wordpress/data';\nimport {\n\tIcon,\n\tToggleControl,\n\tPanelBody,\n\twithNotices,\n} from '@wordpress/components';\nimport {\n\tInspectorControls,\n\tBlockControls,\n\tMediaPlaceholder,\n\tMediaReplaceFlow,\n\tBlockIcon,\n\tuseBlockProps,\n} from '@wordpress/block-editor';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { postFeaturedImage } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport DimensionControls from './dimension-controls';\n\nconst ALLOWED_MEDIA_TYPES = [ 'image' ];\nconst placeholderChip = (\n\t<div className=\"post-featured-image_placeholder\">\n\t\t<Icon icon={ postFeaturedImage } />\n\t\t<p> { __( 'Featured Image' ) }</p>\n\t</div>\n);\n\nfunction PostFeaturedImageDisplay( {\n\tattributes,\n\tsetAttributes,\n\tcontext: { postId, postType, queryId },\n\tnoticeUI,\n\tnoticeOperations,\n} ) {\n\tconst isDescendentOfQueryLoop = !! queryId;\n\tconst { isLink, height, width, scale } = attributes;\n\tconst [ featuredImage, setFeaturedImage ] = useEntityProp(\n\t\t'postType',\n\t\tpostType,\n\t\t'featured_media',\n\t\tpostId\n\t);\n\tconst media = useSelect(\n\t\t( select ) =>\n\t\t\tfeaturedImage &&\n\t\t\tselect( coreStore ).getMedia( featuredImage, { context: 'view' } ),\n\t\t[ featuredImage ]\n\t);\n\tconst blockProps = useBlockProps( {\n\t\tstyle: { width },\n\t} );\n\tconst onSelectImage = ( value ) => {\n\t\tif ( value?.id ) {\n\t\t\tsetFeaturedImage( value.id );\n\t\t}\n\t};\n\tfunction onUploadError( message ) {\n\t\tnoticeOperations.removeAllNotices();\n\t\tnoticeOperations.createErrorNotice( message );\n\t}\n\tlet image;\n\tif ( ! featuredImage && isDescendentOfQueryLoop ) {\n\t\treturn <div { ...blockProps }>{ placeholderChip }</div>;\n\t}\n\tif ( ! featuredImage ) {\n\t\timage = (\n\t\t\t<MediaPlaceholder\n\t\t\t\ticon={ <BlockIcon icon={ postFeaturedImage } /> }\n\t\t\t\tonSelect={ onSelectImage }\n\t\t\t\tnotices={ noticeUI }\n\t\t\t\tonError={ onUploadError }\n\t\t\t\taccept=\"image/*\"\n\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\tlabels={ {\n\t\t\t\t\ttitle: __( 'Featured image' ),\n\t\t\t\t\tinstructions: __(\n\t\t\t\t\t\t'Upload a media file or pick one from your media library.'\n\t\t\t\t\t),\n\t\t\t\t} }\n\t\t\t/>\n\t\t);\n\t} else {\n\t\t// We have a Featured image so show a Placeholder if is loading.\n\t\timage = ! media ? (\n\t\t\tplaceholderChip\n\t\t) : (\n\t\t\t<img\n\t\t\t\tsrc={ media.source_url }\n\t\t\t\talt={ media.alt_text || __( 'Featured image' ) }\n\t\t\t\tstyle={ { height, objectFit: height && scale } }\n\t\t\t/>\n\t\t);\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<InspectorControls>\n\t\t\t\t<DimensionControls\n\t\t\t\t\tattributes={ attributes }\n\t\t\t\t\tsetAttributes={ setAttributes }\n\t\t\t\t/>\n\t\t\t\t<PanelBody title={ __( 'Link settings' ) }>\n\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\tlabel={ sprintf(\n\t\t\t\t\t\t\t// translators: %s: Name of the post type e.g: \"post\".\n\t\t\t\t\t\t\t__( 'Link to %s' ),\n\t\t\t\t\t\t\tpostType\n\t\t\t\t\t\t) }\n\t\t\t\t\t\tonChange={ () => setAttributes( { isLink: ! isLink } ) }\n\t\t\t\t\t\tchecked={ isLink }\n\t\t\t\t\t/>\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t\t{ !! media && ! isDescendentOfQueryLoop && (\n\t\t\t\t<BlockControls group=\"other\">\n\t\t\t\t\t<MediaReplaceFlow\n\t\t\t\t\t\tmediaId={ featuredImage }\n\t\t\t\t\t\tmediaURL={ media.source_url }\n\t\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\t\t\taccept=\"image/*\"\n\t\t\t\t\t\tonSelect={ onSelectImage }\n\t\t\t\t\t\tonError={ onUploadError }\n\t\t\t\t\t/>\n\t\t\t\t</BlockControls>\n\t\t\t) }\n\t\t\t<figure { ...blockProps }>{ image }</figure>\n\t\t</>\n\t);\n}\n\nconst PostFeaturedImageWithNotices = withNotices( PostFeaturedImageDisplay );\n\nexport default function PostFeaturedImageEdit( props ) {\n\tconst blockProps = useBlockProps();\n\tif ( ! props.context?.postId ) {\n\t\treturn <div { ...blockProps }>{ placeholderChip }</div>;\n\t}\n\treturn <PostFeaturedImageWithNotices { ...props } />;\n}\n"]}