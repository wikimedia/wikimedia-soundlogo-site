{"version":3,"sources":["@wordpress/block-library/src/page-list/edit.js"],"names":["MAX_PAGE_COUNT","PageListEdit","context","clientId","attributes","setAttributes","textColor","customTextColor","backgroundColor","customBackgroundColor","overlayTextColor","customOverlayTextColor","overlayBackgroundColor","customOverlayBackgroundColor","style","allowConvertToLinks","setAllowConvertToLinks","blockProps","className","color","isParentNavigation","select","getBlockParentsByBlockName","blockEditorStore","length","isNavigationChild","openSubmenusOnClick","showSubmenuIcon","path","per_page","_fields","parse","then","res","headers","get","isOpen","setOpen","openModal","closeModal","attributesWithParentStatus"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tBlockControls,\n\tuseBlockProps,\n\tstore as blockEditorStore,\n\tgetColorClassName,\n} from '@wordpress/block-editor';\nimport ServerSideRender from '@wordpress/server-side-render';\nimport { ToolbarButton } from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { useEffect, useState } from '@wordpress/element';\nimport { useSelect } from '@wordpress/data';\nimport apiFetch from '@wordpress/api-fetch';\nimport { addQueryArgs } from '@wordpress/url';\n\n/**\n * Internal dependencies\n */\nimport ConvertToLinksModal from './convert-to-links-modal';\n\n// We only show the edit option when page count is <= MAX_PAGE_COUNT\n// Performance of Navigation Links is not good past this value.\nconst MAX_PAGE_COUNT = 100;\n\nexport default function PageListEdit( {\n\tcontext,\n\tclientId,\n\tattributes,\n\tsetAttributes,\n} ) {\n\t// Copy context to attributes to make it accessible in the editor's\n\t// ServerSideRender\n\tuseEffect( () => {\n\t\tconst {\n\t\t\ttextColor,\n\t\t\tcustomTextColor,\n\t\t\tbackgroundColor,\n\t\t\tcustomBackgroundColor,\n\t\t\toverlayTextColor,\n\t\t\tcustomOverlayTextColor,\n\t\t\toverlayBackgroundColor,\n\t\t\tcustomOverlayBackgroundColor,\n\t\t} = context;\n\t\tsetAttributes( {\n\t\t\ttextColor,\n\t\t\tcustomTextColor,\n\t\t\tbackgroundColor,\n\t\t\tcustomBackgroundColor,\n\t\t\toverlayTextColor,\n\t\t\tcustomOverlayTextColor,\n\t\t\toverlayBackgroundColor,\n\t\t\tcustomOverlayBackgroundColor,\n\t\t} );\n\t}, [\n\t\tcontext.textColor,\n\t\tcontext.customTextColor,\n\t\tcontext.backgroundColor,\n\t\tcontext.customBackgroundColor,\n\t\tcontext.overlayTextColor,\n\t\tcontext.customOverlayTextColor,\n\t\tcontext.overlayBackgroundColor,\n\t\tcontext.customOverlayBackgroundColor,\n\t] );\n\n\tconst { textColor, backgroundColor, style } = context || {};\n\n\tconst [ allowConvertToLinks, setAllowConvertToLinks ] = useState( false );\n\n\tconst blockProps = useBlockProps( {\n\t\tclassName: classnames( {\n\t\t\t'has-text-color': !! textColor,\n\t\t\t[ getColorClassName( 'color', textColor ) ]: !! textColor,\n\t\t\t'has-background': !! backgroundColor,\n\t\t\t[ getColorClassName(\n\t\t\t\t'background-color',\n\t\t\t\tbackgroundColor\n\t\t\t) ]: !! backgroundColor,\n\t\t} ),\n\t\tstyle: { ...style?.color },\n\t} );\n\n\tconst isParentNavigation = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getBlockParentsByBlockName } = select( blockEditorStore );\n\t\t\treturn (\n\t\t\t\tgetBlockParentsByBlockName( clientId, 'core/navigation' )\n\t\t\t\t\t.length > 0\n\t\t\t);\n\t\t},\n\t\t[ clientId ]\n\t);\n\n\tuseEffect( () => {\n\t\tsetAttributes( {\n\t\t\tisNavigationChild: isParentNavigation,\n\t\t\topenSubmenusOnClick: !! context.openSubmenusOnClick,\n\t\t\tshowSubmenuIcon: !! context.showSubmenuIcon,\n\t\t} );\n\t}, [ context.openSubmenusOnClick, context.showSubmenuIcon ] );\n\n\tuseEffect( () => {\n\t\tif ( isParentNavigation ) {\n\t\t\tapiFetch( {\n\t\t\t\tpath: addQueryArgs( '/wp/v2/pages', {\n\t\t\t\t\tper_page: 1,\n\t\t\t\t\t_fields: [ 'id' ],\n\t\t\t\t} ),\n\t\t\t\tparse: false,\n\t\t\t} ).then( ( res ) => {\n\t\t\t\tsetAllowConvertToLinks(\n\t\t\t\t\tres.headers.get( 'X-WP-Total' ) <= MAX_PAGE_COUNT\n\t\t\t\t);\n\t\t\t} );\n\t\t} else {\n\t\t\tsetAllowConvertToLinks( false );\n\t\t}\n\t}, [ isParentNavigation ] );\n\n\tconst [ isOpen, setOpen ] = useState( false );\n\tconst openModal = () => setOpen( true );\n\tconst closeModal = () => setOpen( false );\n\n\t// Update parent status before component first renders.\n\tconst attributesWithParentStatus = {\n\t\t...attributes,\n\t\tisNavigationChild: isParentNavigation,\n\t\topenSubmenusOnClick: !! context.openSubmenusOnClick,\n\t\tshowSubmenuIcon: !! context.showSubmenuIcon,\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t{ allowConvertToLinks && (\n\t\t\t\t<BlockControls group=\"other\">\n\t\t\t\t\t<ToolbarButton title={ __( 'Edit' ) } onClick={ openModal }>\n\t\t\t\t\t\t{ __( 'Edit' ) }\n\t\t\t\t\t</ToolbarButton>\n\t\t\t\t</BlockControls>\n\t\t\t) }\n\t\t\t{ allowConvertToLinks && isOpen && (\n\t\t\t\t<ConvertToLinksModal\n\t\t\t\t\tonClose={ closeModal }\n\t\t\t\t\tclientId={ clientId }\n\t\t\t\t/>\n\t\t\t) }\n\t\t\t<div { ...blockProps }>\n\t\t\t\t<ServerSideRender\n\t\t\t\t\tblock=\"core/page-list\"\n\t\t\t\t\tattributes={ attributesWithParentStatus }\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</>\n\t);\n}\n"]}