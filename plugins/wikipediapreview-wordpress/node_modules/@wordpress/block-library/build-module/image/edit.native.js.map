{"version":3,"sources":["@wordpress/block-library/src/image/edit.native.js"],"names":["View","TouchableWithoutFeedback","Component","requestMediaImport","mediaUploadSync","requestImageFailedRetryDialog","requestImageUploadCancelDialog","requestImageFullscreenPreview","setFeaturedImage","Icon","PanelBody","ToolbarButton","ToolbarGroup","Image","WIDE_ALIGNMENTS","LinkSettingsNavigation","BottomSheet","BottomSheetTextControl","BottomSheetSelectControl","FooterMessageControl","FooterMessageLink","Badge","BlockCaption","MediaPlaceholder","MediaUpload","MediaUploadProgress","MEDIA_TYPE_IMAGE","BlockControls","InspectorControls","BlockAlignmentToolbar","BlockStyles","store","blockEditorStore","__","_x","sprintf","getProtocol","hasQueryArg","doAction","hasAction","compose","withPreferredColorScheme","withSelect","withDispatch","image","placeholderIcon","replace","fullscreen","textColor","coreStore","editPostStore","styles","getUpdatedLinkTargetSettings","LINK_DESTINATION_CUSTOM","LINK_DESTINATION_ATTACHMENT","LINK_DESTINATION_MEDIA","MEDIA_ID_NO_FEATURED_IMAGE_SET","getUrlForSlug","sizeSlug","undefined","media_details","sizes","source_url","ImageEdit","constructor","props","state","isCaptionSelected","finishMediaUploadWithSuccess","bind","finishMediaUploadWithFailure","mediaUploadStateReset","onSelectMediaUploadOption","updateMediaProgress","updateImageURL","onSetLinkDestination","onSetNewTab","onSetSizeSlug","onImagePressed","onSetFeatured","onFocusCaption","updateAlignment","accessibilityLabelCreator","setMappedAttributes","onSizeChangeValue","linkSettingsOptions","url","label","placeholder","autoFocus","autoFill","openInNewTab","linkRel","componentDidMount","attributes","setAttributes","id","console","warn","componentWillUnmount","isUploadInProgress","componentDidUpdate","previousProps","getDerivedStateFromProps","isSelected","caption","trim","length","setState","payload","mediaUrl","mediaServerId","mediaId","width","height","nextAlign","extraUpdatedAttributes","Object","values","alignments","includes","align","href","linkDestination","value","updatedLinkTarget","media","imageDefaultSize","destination","mediaAttributes","additionalAttributes","link","onFocus","getPlaceholderIcon","getStylesFromColorScheme","iconPlaceholder","iconPlaceholderDark","getWidth","restAttributes","getLinkSettings","isLinkSheetVisible","unMappedAttributes","mappedAttributes","rel","linkTarget","dismissSheet","getAltTextSettings","alt","updateAlt","newAlt","newValue","closeSettingsBottomSheet","getFeaturedButtonPanel","isFeaturedImage","setFeaturedButtonStyle","setFeaturedButton","setFeaturedButtonDark","removeFeaturedButton","setFeaturedButtonCellContainer","render","clientId","context","featuredImageId","wasBlockJustInserted","className","hasImageContext","keys","imageSizes","Array","isArray","sizeOptions","filter","slug","map","name","selectedSizeOption","sizeOptionsValid","find","option","canImageBeFeatured","getToolbarEditButton","open","getInspectorControls","panelBody","featuredImagePanelTitle","content","alignToFlex","left","center","right","full","wide","additionalImageProps","resizeMode","imageCrop","imageContainerStyles","fixedHeight","getImageComponent","openMediaOptions","getMediaOptions","isUploadFailed","retryMessage","onBlur","insertBlocksAfter","select","getMedia","getSettings","getEditedPostAttribute","isNotFileUrl","shouldGetMedia","dispatch","closeGeneralSidebar"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { View, TouchableWithoutFeedback } from 'react-native';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport {\n\trequestMediaImport,\n\tmediaUploadSync,\n\trequestImageFailedRetryDialog,\n\trequestImageUploadCancelDialog,\n\trequestImageFullscreenPreview,\n\tsetFeaturedImage,\n} from '@wordpress/react-native-bridge';\nimport {\n\tIcon,\n\tPanelBody,\n\tToolbarButton,\n\tToolbarGroup,\n\tImage,\n\tWIDE_ALIGNMENTS,\n\tLinkSettingsNavigation,\n\tBottomSheet,\n\tBottomSheetTextControl,\n\tBottomSheetSelectControl,\n\tFooterMessageControl,\n\tFooterMessageLink,\n\tBadge,\n} from '@wordpress/components';\nimport {\n\tBlockCaption,\n\tMediaPlaceholder,\n\tMediaUpload,\n\tMediaUploadProgress,\n\tMEDIA_TYPE_IMAGE,\n\tBlockControls,\n\tInspectorControls,\n\tBlockAlignmentToolbar,\n\tBlockStyles,\n\tstore as blockEditorStore,\n} from '@wordpress/block-editor';\nimport { __, _x, sprintf } from '@wordpress/i18n';\nimport { getProtocol, hasQueryArg } from '@wordpress/url';\nimport { doAction, hasAction } from '@wordpress/hooks';\nimport { compose, withPreferredColorScheme } from '@wordpress/compose';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport {\n\timage as placeholderIcon,\n\treplace,\n\tfullscreen,\n\ttextColor,\n} from '@wordpress/icons';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { store as editPostStore } from '@wordpress/edit-post';\n\n/**\n * Internal dependencies\n */\nimport styles from './styles.scss';\nimport { getUpdatedLinkTargetSettings } from './utils';\n\nimport {\n\tLINK_DESTINATION_CUSTOM,\n\tLINK_DESTINATION_ATTACHMENT,\n\tLINK_DESTINATION_MEDIA,\n\tMEDIA_ID_NO_FEATURED_IMAGE_SET,\n} from './constants';\n\nconst getUrlForSlug = ( image, sizeSlug ) => {\n\tif ( ! sizeSlug ) {\n\t\treturn undefined;\n\t}\n\treturn image?.media_details?.sizes?.[ sizeSlug ]?.source_url;\n};\n\nexport class ImageEdit extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\n\t\tthis.state = {\n\t\t\tisCaptionSelected: false,\n\t\t};\n\n\t\tthis.finishMediaUploadWithSuccess = this.finishMediaUploadWithSuccess.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.finishMediaUploadWithFailure = this.finishMediaUploadWithFailure.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.mediaUploadStateReset = this.mediaUploadStateReset.bind( this );\n\t\tthis.onSelectMediaUploadOption = this.onSelectMediaUploadOption.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.updateMediaProgress = this.updateMediaProgress.bind( this );\n\t\tthis.updateImageURL = this.updateImageURL.bind( this );\n\t\tthis.onSetLinkDestination = this.onSetLinkDestination.bind( this );\n\t\tthis.onSetNewTab = this.onSetNewTab.bind( this );\n\t\tthis.onSetSizeSlug = this.onSetSizeSlug.bind( this );\n\t\tthis.onImagePressed = this.onImagePressed.bind( this );\n\t\tthis.onSetFeatured = this.onSetFeatured.bind( this );\n\t\tthis.onFocusCaption = this.onFocusCaption.bind( this );\n\t\tthis.updateAlignment = this.updateAlignment.bind( this );\n\t\tthis.accessibilityLabelCreator = this.accessibilityLabelCreator.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.setMappedAttributes = this.setMappedAttributes.bind( this );\n\t\tthis.onSizeChangeValue = this.onSizeChangeValue.bind( this );\n\n\t\tthis.linkSettingsOptions = {\n\t\t\turl: {\n\t\t\t\tlabel: __( 'Image Link URL' ),\n\t\t\t\tplaceholder: __( 'Add URL' ),\n\t\t\t\tautoFocus: false,\n\t\t\t\tautoFill: true,\n\t\t\t},\n\t\t\topenInNewTab: {\n\t\t\t\tlabel: __( 'Open in new tab' ),\n\t\t\t},\n\t\t\tlinkRel: {\n\t\t\t\tlabel: __( 'Link Rel' ),\n\t\t\t\tplaceholder: _x(\n\t\t\t\t\t'None',\n\t\t\t\t\t'Link rel attribute value placeholder'\n\t\t\t\t),\n\t\t\t},\n\t\t};\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { attributes, setAttributes } = this.props;\n\t\t// This will warn when we have `id` defined, while `url` is undefined.\n\t\t// This may help track this issue: https://github.com/wordpress-mobile/WordPress-Android/issues/9768\n\t\t// where a cancelled image upload was resulting in a subsequent crash.\n\t\tif ( attributes.id && ! attributes.url ) {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.warn( 'Attributes has id with no url.' );\n\t\t}\n\n\t\t// Detect any pasted image and start an upload\n\t\tif (\n\t\t\t! attributes.id &&\n\t\t\tattributes.url &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\trequestMediaImport( attributes.url, ( id, url ) => {\n\t\t\t\tif ( url ) {\n\t\t\t\t\tsetAttributes( { id, url } );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\t// Make sure we mark any temporary images as failed if they failed while\n\t\t// the editor wasn't open\n\t\tif (\n\t\t\tattributes.id &&\n\t\t\tattributes.url &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\tmediaUploadSync();\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\t// this action will only exist if the user pressed the trash button on the block holder\n\t\tif (\n\t\t\thasAction( 'blocks.onRemoveBlockCheckUpload' ) &&\n\t\t\tthis.state.isUploadInProgress\n\t\t) {\n\t\t\tdoAction(\n\t\t\t\t'blocks.onRemoveBlockCheckUpload',\n\t\t\t\tthis.props.attributes.id\n\t\t\t);\n\t\t}\n\t}\n\n\tcomponentDidUpdate( previousProps ) {\n\t\tconst { image, attributes, setAttributes } = this.props;\n\t\tif ( ! previousProps.image && image ) {\n\t\t\tconst url =\n\t\t\t\tgetUrlForSlug( image, attributes?.sizeSlug ) ||\n\t\t\t\timage.source_url;\n\t\t\tsetAttributes( { url } );\n\t\t}\n\t}\n\n\tstatic getDerivedStateFromProps( props, state ) {\n\t\t// Avoid a UI flicker in the toolbar by insuring that isCaptionSelected\n\t\t// is updated immediately any time the isSelected prop becomes false\n\t\treturn {\n\t\t\tisCaptionSelected: props.isSelected && state.isCaptionSelected,\n\t\t};\n\t}\n\n\taccessibilityLabelCreator( caption ) {\n\t\t// Checks if caption is empty.\n\t\treturn ( typeof caption === 'string' && caption.trim().length === 0 ) ||\n\t\t\tcaption === undefined ||\n\t\t\tcaption === null\n\t\t\t? /* translators: accessibility text. Empty image caption. */\n\t\t\t  'Image caption. Empty'\n\t\t\t: sprintf(\n\t\t\t\t\t/* translators: accessibility text. %s: image caption. */\n\t\t\t\t\t__( 'Image caption. %s' ),\n\t\t\t\t\tcaption\n\t\t\t  );\n\t}\n\n\tonImagePressed() {\n\t\tconst { attributes, image } = this.props;\n\n\t\tif ( this.state.isUploadInProgress ) {\n\t\t\trequestImageUploadCancelDialog( attributes.id );\n\t\t} else if (\n\t\t\tattributes.id &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\trequestImageFailedRetryDialog( attributes.id );\n\t\t} else if ( ! this.state.isCaptionSelected ) {\n\t\t\trequestImageFullscreenPreview(\n\t\t\t\tattributes.url,\n\t\t\t\timage && image.source_url\n\t\t\t);\n\t\t}\n\n\t\tthis.setState( {\n\t\t\tisCaptionSelected: false,\n\t\t} );\n\t}\n\n\tupdateMediaProgress( payload ) {\n\t\tconst { setAttributes } = this.props;\n\t\tif ( payload.mediaUrl ) {\n\t\t\tsetAttributes( { url: payload.mediaUrl } );\n\t\t}\n\n\t\tif ( ! this.state.isUploadInProgress ) {\n\t\t\tthis.setState( { isUploadInProgress: true } );\n\t\t}\n\t}\n\n\tfinishMediaUploadWithSuccess( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { url: payload.mediaUrl, id: payload.mediaServerId } );\n\t\tthis.setState( { isUploadInProgress: false } );\n\t}\n\n\tfinishMediaUploadWithFailure( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { id: payload.mediaId } );\n\t\tthis.setState( { isUploadInProgress: false } );\n\t}\n\n\tmediaUploadStateReset() {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { id: null, url: null } );\n\t\tthis.setState( { isUploadInProgress: false } );\n\t}\n\n\tupdateImageURL( url ) {\n\t\tthis.props.setAttributes( {\n\t\t\turl,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t} );\n\t}\n\n\tupdateAlignment( nextAlign ) {\n\t\tconst extraUpdatedAttributes = Object.values(\n\t\t\tWIDE_ALIGNMENTS.alignments\n\t\t).includes( nextAlign )\n\t\t\t? { width: undefined, height: undefined }\n\t\t\t: {};\n\t\tthis.props.setAttributes( {\n\t\t\t...extraUpdatedAttributes,\n\t\t\talign: nextAlign,\n\t\t} );\n\t}\n\n\tonSetLinkDestination( href ) {\n\t\tthis.props.setAttributes( {\n\t\t\tlinkDestination: LINK_DESTINATION_CUSTOM,\n\t\t\thref,\n\t\t} );\n\t}\n\n\tonSetNewTab( value ) {\n\t\tconst updatedLinkTarget = getUpdatedLinkTargetSettings(\n\t\t\tvalue,\n\t\t\tthis.props.attributes\n\t\t);\n\t\tthis.props.setAttributes( updatedLinkTarget );\n\t}\n\n\tonSetSizeSlug( sizeSlug ) {\n\t\tconst { image, setAttributes } = this.props;\n\n\t\tconst url = getUrlForSlug( image, sizeSlug );\n\t\tif ( ! url ) {\n\t\t\treturn null;\n\t\t}\n\t\tsetAttributes( {\n\t\t\turl,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t\tsizeSlug,\n\t\t} );\n\t}\n\n\tonSelectMediaUploadOption( media ) {\n\t\tconst { imageDefaultSize } = this.props;\n\t\tconst { id, url, destination } = this.props.attributes;\n\t\tconst mediaAttributes = {\n\t\t\tid: media.id,\n\t\t\turl: media.url,\n\t\t\tcaption: media.caption,\n\t\t};\n\n\t\tlet additionalAttributes;\n\t\t// Reset the dimension attributes if changing to a different image.\n\t\tif ( ! media.id || media.id !== id ) {\n\t\t\tadditionalAttributes = {\n\t\t\t\twidth: undefined,\n\t\t\t\theight: undefined,\n\t\t\t\tsizeSlug: imageDefaultSize,\n\t\t\t};\n\t\t} else {\n\t\t\t// Keep the same url when selecting the same file, so \"Image Size\" option is not changed.\n\t\t\tadditionalAttributes = { url };\n\t\t}\n\n\t\tlet href;\n\t\tswitch ( destination ) {\n\t\t\tcase LINK_DESTINATION_MEDIA:\n\t\t\t\thref = media.url;\n\t\t\t\tbreak;\n\t\t\tcase LINK_DESTINATION_ATTACHMENT:\n\t\t\t\thref = media.link;\n\t\t\t\tbreak;\n\t\t}\n\t\tmediaAttributes.href = href;\n\n\t\tthis.props.setAttributes( {\n\t\t\t...mediaAttributes,\n\t\t\t...additionalAttributes,\n\t\t} );\n\t}\n\n\tonFocusCaption() {\n\t\tif ( this.props.onFocus ) {\n\t\t\tthis.props.onFocus();\n\t\t}\n\t\tif ( ! this.state.isCaptionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tisCaptionSelected: true,\n\t\t\t} );\n\t\t}\n\t}\n\n\tgetPlaceholderIcon() {\n\t\treturn (\n\t\t\t<Icon\n\t\t\t\ticon={ placeholderIcon }\n\t\t\t\t{ ...this.props.getStylesFromColorScheme(\n\t\t\t\t\tstyles.iconPlaceholder,\n\t\t\t\t\tstyles.iconPlaceholderDark\n\t\t\t\t) }\n\t\t\t/>\n\t\t);\n\t}\n\n\tgetWidth() {\n\t\tconst { attributes } = this.props;\n\t\tconst { align, width } = attributes;\n\n\t\treturn Object.values( WIDE_ALIGNMENTS.alignments ).includes( align )\n\t\t\t? '100%'\n\t\t\t: width;\n\t}\n\n\tsetMappedAttributes( { url: href, ...restAttributes } ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\treturn href === undefined\n\t\t\t? setAttributes( {\n\t\t\t\t\t...restAttributes,\n\t\t\t\t\tlinkDestination: LINK_DESTINATION_CUSTOM,\n\t\t\t  } )\n\t\t\t: setAttributes( {\n\t\t\t\t\t...restAttributes,\n\t\t\t\t\thref,\n\t\t\t\t\tlinkDestination: LINK_DESTINATION_CUSTOM,\n\t\t\t  } );\n\t}\n\n\tgetLinkSettings() {\n\t\tconst { isLinkSheetVisible } = this.state;\n\t\tconst {\n\t\t\tattributes: { href: url, ...unMappedAttributes },\n\t\t} = this.props;\n\t\tconst mappedAttributes = { ...unMappedAttributes, url };\n\n\t\treturn (\n\t\t\t<LinkSettingsNavigation\n\t\t\t\tisVisible={ isLinkSheetVisible }\n\t\t\t\turl={ mappedAttributes.url }\n\t\t\t\trel={ mappedAttributes.rel }\n\t\t\t\tlabel={ mappedAttributes.label }\n\t\t\t\tlinkTarget={ mappedAttributes.linkTarget }\n\t\t\t\tonClose={ this.dismissSheet }\n\t\t\t\tsetAttributes={ this.setMappedAttributes }\n\t\t\t\twithBottomSheet={ false }\n\t\t\t\thasPicker\n\t\t\t\toptions={ this.linkSettingsOptions }\n\t\t\t\tshowIcon={ false }\n\t\t\t/>\n\t\t);\n\t}\n\n\tgetAltTextSettings() {\n\t\tconst {\n\t\t\tattributes: { alt },\n\t\t} = this.props;\n\n\t\tconst updateAlt = ( newAlt ) => {\n\t\t\tthis.props.setAttributes( { alt: newAlt } );\n\t\t};\n\n\t\treturn (\n\t\t\t<BottomSheetTextControl\n\t\t\t\tinitialValue={ alt }\n\t\t\t\tonChange={ updateAlt }\n\t\t\t\tplaceholder={ __( 'Add alt text' ) }\n\t\t\t\tlabel={ __( 'Alt Text' ) }\n\t\t\t\ticon={ textColor }\n\t\t\t\tfooterNote={\n\t\t\t\t\t<>\n\t\t\t\t\t\t{ __(\n\t\t\t\t\t\t\t'Describe the purpose of the image. Leave empty if the image is purely decorative. '\n\t\t\t\t\t\t) }\n\t\t\t\t\t\t<FooterMessageLink\n\t\t\t\t\t\t\thref={\n\t\t\t\t\t\t\t\t'https://www.w3.org/WAI/tutorials/images/decision-tree/'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvalue={ __( 'What is alt text?' ) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</>\n\t\t\t\t}\n\t\t\t/>\n\t\t);\n\t}\n\n\tonSizeChangeValue( newValue ) {\n\t\tthis.onSetSizeSlug( newValue );\n\t}\n\n\tonSetFeatured( mediaId ) {\n\t\tconst { closeSettingsBottomSheet } = this.props;\n\t\tsetFeaturedImage( mediaId );\n\t\tcloseSettingsBottomSheet();\n\t}\n\n\tgetFeaturedButtonPanel( isFeaturedImage ) {\n\t\tconst { attributes, getStylesFromColorScheme } = this.props;\n\n\t\tconst setFeaturedButtonStyle = getStylesFromColorScheme(\n\t\t\tstyles.setFeaturedButton,\n\t\t\tstyles.setFeaturedButtonDark\n\t\t);\n\n\t\tconst removeFeaturedButton = () => (\n\t\t\t<BottomSheet.Cell\n\t\t\t\tlabel={ __( 'Remove as Featured Image ' ) }\n\t\t\t\tlabelStyle={ [\n\t\t\t\t\tsetFeaturedButtonStyle,\n\t\t\t\t\tstyles.removeFeaturedButton,\n\t\t\t\t] }\n\t\t\t\tcellContainerStyle={ styles.setFeaturedButtonCellContainer }\n\t\t\t\tseparatorType={ 'none' }\n\t\t\t\tonPress={ () =>\n\t\t\t\t\tthis.onSetFeatured( MEDIA_ID_NO_FEATURED_IMAGE_SET )\n\t\t\t\t}\n\t\t\t/>\n\t\t);\n\n\t\tconst setFeaturedButton = () => (\n\t\t\t<BottomSheet.Cell\n\t\t\t\tlabel={ __( 'Set as Featured Image ' ) }\n\t\t\t\tlabelStyle={ setFeaturedButtonStyle }\n\t\t\t\tcellContainerStyle={ styles.setFeaturedButtonCellContainer }\n\t\t\t\tseparatorType={ 'none' }\n\t\t\t\tonPress={ () => this.onSetFeatured( attributes.id ) }\n\t\t\t/>\n\t\t);\n\n\t\treturn isFeaturedImage ? removeFeaturedButton() : setFeaturedButton();\n\t}\n\n\trender() {\n\t\tconst { isCaptionSelected } = this.state;\n\t\tconst {\n\t\t\tattributes,\n\t\t\tisSelected,\n\t\t\timage,\n\t\t\tclientId,\n\t\t\timageDefaultSize,\n\t\t\tcontext,\n\t\t\tfeaturedImageId,\n\t\t\twasBlockJustInserted,\n\t\t} = this.props;\n\t\tconst { align, url, alt, id, sizeSlug, className } = attributes;\n\t\tconst hasImageContext = context\n\t\t\t? Object.keys( context ).length > 0\n\t\t\t: false;\n\n\t\tconst imageSizes = Array.isArray( this.props.imageSizes )\n\t\t\t? this.props.imageSizes\n\t\t\t: [];\n\t\t// Only map available image sizes for the user to choose.\n\t\tconst sizeOptions = imageSizes\n\t\t\t.filter( ( { slug } ) => getUrlForSlug( image, slug ) )\n\t\t\t.map( ( { name, slug } ) => ( { value: slug, label: name } ) );\n\n\t\tlet selectedSizeOption = sizeSlug || imageDefaultSize;\n\t\tlet sizeOptionsValid = sizeOptions.find(\n\t\t\t( option ) => option.value === selectedSizeOption\n\t\t);\n\n\t\tif ( ! sizeOptionsValid ) {\n\t\t\t// Default to 'full' size if the default large size is not available.\n\t\t\tsizeOptionsValid = sizeOptions.find(\n\t\t\t\t( option ) => option.value === 'full'\n\t\t\t);\n\t\t\tselectedSizeOption = 'full';\n\t\t}\n\n\t\t// By default, it's only possible to set images that have been uploaded to a site's library as featured.\n\t\t// The 'canImageBeFeatured' check filters out images that haven't been uploaded based on the following:\n\t\t// - Images that are embedded in a post but are uploaded elsewhere have an id of 'undefined'.\n\t\t// - Image that are uploading or have failed to upload are given a temporary negative ID.\n\t\tconst canImageBeFeatured =\n\t\t\ttypeof attributes.id !== 'undefined' && attributes.id > 0;\n\n\t\tconst isFeaturedImage =\n\t\t\tcanImageBeFeatured && featuredImageId === attributes.id;\n\n\t\tconst getToolbarEditButton = ( open ) => (\n\t\t\t<BlockControls>\n\t\t\t\t<ToolbarGroup>\n\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\ttitle={ __( 'Edit image' ) }\n\t\t\t\t\t\ticon={ replace }\n\t\t\t\t\t\tonClick={ open }\n\t\t\t\t\t/>\n\t\t\t\t</ToolbarGroup>\n\t\t\t\t<BlockAlignmentToolbar\n\t\t\t\t\tvalue={ align }\n\t\t\t\t\tonChange={ this.updateAlignment }\n\t\t\t\t/>\n\t\t\t</BlockControls>\n\t\t);\n\n\t\tconst getInspectorControls = () => (\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'Image settings' ) } />\n\t\t\t\t<PanelBody style={ styles.panelBody }>\n\t\t\t\t\t<BlockStyles clientId={ clientId } url={ url } />\n\t\t\t\t</PanelBody>\n\t\t\t\t<PanelBody>\n\t\t\t\t\t{ image && sizeOptionsValid && (\n\t\t\t\t\t\t<BottomSheetSelectControl\n\t\t\t\t\t\t\ticon={ fullscreen }\n\t\t\t\t\t\t\tlabel={ __( 'Size' ) }\n\t\t\t\t\t\t\toptions={ sizeOptions }\n\t\t\t\t\t\t\tonChange={ this.onSizeChangeValue }\n\t\t\t\t\t\t\tvalue={ selectedSizeOption }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t{ this.getAltTextSettings() }\n\t\t\t\t</PanelBody>\n\t\t\t\t<PanelBody title={ __( 'Link Settings' ) }>\n\t\t\t\t\t{ this.getLinkSettings( true ) }\n\t\t\t\t</PanelBody>\n\t\t\t\t<PanelBody\n\t\t\t\t\ttitle={ __( 'Featured Image' ) }\n\t\t\t\t\ttitleStyle={ styles.featuredImagePanelTitle }\n\t\t\t\t>\n\t\t\t\t\t{ canImageBeFeatured &&\n\t\t\t\t\t\tthis.getFeaturedButtonPanel( isFeaturedImage ) }\n\t\t\t\t\t<FooterMessageControl\n\t\t\t\t\t\tlabel={ __(\n\t\t\t\t\t\t\t'Changes to featured image will not be affected by the undo/redo buttons.'\n\t\t\t\t\t\t) }\n\t\t\t\t\t\tcellContainerStyle={\n\t\t\t\t\t\t\tstyles.setFeaturedButtonCellContainer\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t);\n\n\t\tif ( ! url ) {\n\t\t\treturn (\n\t\t\t\t<View style={ styles.content }>\n\t\t\t\t\t<MediaPlaceholder\n\t\t\t\t\t\tallowedTypes={ [ MEDIA_TYPE_IMAGE ] }\n\t\t\t\t\t\tonSelect={ this.onSelectMediaUploadOption }\n\t\t\t\t\t\ticon={ this.getPlaceholderIcon() }\n\t\t\t\t\t\tonFocus={ this.props.onFocus }\n\t\t\t\t\t\tautoOpenMediaUpload={\n\t\t\t\t\t\t\tisSelected && wasBlockJustInserted\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t</View>\n\t\t\t);\n\t\t}\n\n\t\tconst alignToFlex = {\n\t\t\tleft: 'flex-start',\n\t\t\tcenter: 'center',\n\t\t\tright: 'flex-end',\n\t\t\tfull: 'center',\n\t\t\twide: 'center',\n\t\t};\n\n\t\tconst additionalImageProps = {\n\t\t\theight: '100%',\n\t\t\tresizeMode: context?.imageCrop ? 'cover' : 'contain',\n\t\t};\n\n\t\tconst imageContainerStyles = [ hasImageContext && styles.fixedHeight ];\n\n\t\tconst getImageComponent = ( openMediaOptions, getMediaOptions ) => (\n\t\t\t<Badge label={ __( 'Featured' ) } show={ isFeaturedImage }>\n\t\t\t\t<TouchableWithoutFeedback\n\t\t\t\t\taccessible={ ! isSelected }\n\t\t\t\t\tonPress={ this.onImagePressed }\n\t\t\t\t\tonLongPress={ openMediaOptions }\n\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t>\n\t\t\t\t\t<View style={ styles.content }>\n\t\t\t\t\t\t{ isSelected && getInspectorControls() }\n\t\t\t\t\t\t{ isSelected && getMediaOptions() }\n\t\t\t\t\t\t{ ! this.state.isCaptionSelected &&\n\t\t\t\t\t\t\tgetToolbarEditButton( openMediaOptions ) }\n\t\t\t\t\t\t<MediaUploadProgress\n\t\t\t\t\t\t\tcoverUrl={ url }\n\t\t\t\t\t\t\tmediaId={ id }\n\t\t\t\t\t\t\tonUpdateMediaProgress={ this.updateMediaProgress }\n\t\t\t\t\t\t\tonFinishMediaUploadWithSuccess={\n\t\t\t\t\t\t\t\tthis.finishMediaUploadWithSuccess\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonFinishMediaUploadWithFailure={\n\t\t\t\t\t\t\t\tthis.finishMediaUploadWithFailure\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonMediaUploadStateReset={\n\t\t\t\t\t\t\t\tthis.mediaUploadStateReset\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\trenderContent={ ( {\n\t\t\t\t\t\t\t\tisUploadInProgress,\n\t\t\t\t\t\t\t\tisUploadFailed,\n\t\t\t\t\t\t\t\tretryMessage,\n\t\t\t\t\t\t\t} ) => {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<View style={ imageContainerStyles }>\n\t\t\t\t\t\t\t\t\t\t<Image\n\t\t\t\t\t\t\t\t\t\t\talign={\n\t\t\t\t\t\t\t\t\t\t\t\talign && alignToFlex[ align ]\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\talt={ alt }\n\t\t\t\t\t\t\t\t\t\t\tisSelected={\n\t\t\t\t\t\t\t\t\t\t\t\tisSelected &&\n\t\t\t\t\t\t\t\t\t\t\t\t! isCaptionSelected\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tisUploadFailed={ isUploadFailed }\n\t\t\t\t\t\t\t\t\t\t\tisUploadInProgress={\n\t\t\t\t\t\t\t\t\t\t\t\tisUploadInProgress\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tonSelectMediaUploadOption={\n\t\t\t\t\t\t\t\t\t\t\t\tthis.onSelectMediaUploadOption\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\topenMediaOptions={\n\t\t\t\t\t\t\t\t\t\t\t\topenMediaOptions\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tretryMessage={ retryMessage }\n\t\t\t\t\t\t\t\t\t\t\turl={ url }\n\t\t\t\t\t\t\t\t\t\t\tshapeStyle={ styles[ className ] }\n\t\t\t\t\t\t\t\t\t\t\twidth={ this.getWidth() }\n\t\t\t\t\t\t\t\t\t\t\t{ ...( hasImageContext\n\t\t\t\t\t\t\t\t\t\t\t\t? additionalImageProps\n\t\t\t\t\t\t\t\t\t\t\t\t: {} ) }\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</View>\n\t\t\t\t</TouchableWithoutFeedback>\n\t\t\t\t<BlockCaption\n\t\t\t\t\tclientId={ this.props.clientId }\n\t\t\t\t\tisSelected={ this.state.isCaptionSelected }\n\t\t\t\t\taccessible\n\t\t\t\t\taccessibilityLabelCreator={ this.accessibilityLabelCreator }\n\t\t\t\t\tonFocus={ this.onFocusCaption }\n\t\t\t\t\tonBlur={ this.props.onBlur } // always assign onBlur as props\n\t\t\t\t\tinsertBlocksAfter={ this.props.insertBlocksAfter }\n\t\t\t\t/>\n\t\t\t</Badge>\n\t\t);\n\n\t\treturn (\n\t\t\t<MediaUpload\n\t\t\t\tallowedTypes={ [ MEDIA_TYPE_IMAGE ] }\n\t\t\t\tisReplacingMedia={ true }\n\t\t\t\tonSelect={ this.onSelectMediaUploadOption }\n\t\t\t\trender={ ( { open, getMediaOptions } ) => {\n\t\t\t\t\treturn getImageComponent( open, getMediaOptions );\n\t\t\t\t} }\n\t\t\t/>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select, props ) => {\n\t\tconst { getMedia } = select( coreStore );\n\t\tconst { getSettings, wasBlockJustInserted } = select(\n\t\t\tblockEditorStore\n\t\t);\n\t\tconst { getEditedPostAttribute } = select( 'core/editor' );\n\t\tconst {\n\t\t\tattributes: { id, url },\n\t\t\tisSelected,\n\t\t\tclientId,\n\t\t} = props;\n\t\tconst { imageSizes, imageDefaultSize } = getSettings();\n\t\tconst isNotFileUrl = id && getProtocol( url ) !== 'file:';\n\t\tconst featuredImageId = getEditedPostAttribute( 'featured_media' );\n\n\t\tconst shouldGetMedia =\n\t\t\t( isSelected && isNotFileUrl ) ||\n\t\t\t// Edge case to update the image after uploading if the block gets unselected\n\t\t\t// Check if it's the original image and not the resized one with queryparams\n\t\t\t( ! isSelected &&\n\t\t\t\tisNotFileUrl &&\n\t\t\t\turl &&\n\t\t\t\t! hasQueryArg( url, 'w' ) );\n\n\t\treturn {\n\t\t\timage: shouldGetMedia ? getMedia( id ) : null,\n\t\t\timageSizes,\n\t\t\timageDefaultSize,\n\t\t\tfeaturedImageId,\n\t\t\twasBlockJustInserted: wasBlockJustInserted(\n\t\t\t\tclientId,\n\t\t\t\t'inserter_menu'\n\t\t\t),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\treturn {\n\t\t\tcloseSettingsBottomSheet() {\n\t\t\t\tdispatch( editPostStore ).closeGeneralSidebar();\n\t\t\t},\n\t\t};\n\t} ),\n\twithPreferredColorScheme,\n] )( ImageEdit );\n"]}