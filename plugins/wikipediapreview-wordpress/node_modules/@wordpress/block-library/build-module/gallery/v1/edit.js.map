{"version":3,"sources":["@wordpress/block-library/src/gallery/v1/edit.js"],"names":["every","filter","find","forEach","get","isEmpty","map","reduce","some","toString","compose","PanelBody","SelectControl","ToggleControl","withNotices","RangeControl","ToolbarButton","BlockControls","MediaPlaceholder","InspectorControls","useBlockProps","store","blockEditorStore","Platform","useEffect","useState","useMemo","__","getBlobByURL","isBlobURL","revokeBlobURL","useDispatch","useSelect","withViewportMatch","View","coreStore","sharedIcon","pickRelevantMediaFiles","defaultColumnsNumberV1","Gallery","LINK_DESTINATION_ATTACHMENT","LINK_DESTINATION_MEDIA","LINK_DESTINATION_NONE","UpdateGalleryModal","MAX_COLUMNS","linkOptions","value","label","ALLOWED_MEDIA_TYPES","PLACEHOLDER_TEXT","select","web","native","MOBILE_CONTROL_PROPS_RANGE_CONTROL","type","GalleryEdit","props","attributes","clientId","isSelected","noticeUI","noticeOperations","onFocus","columns","imageCrop","images","linkTo","sizeSlug","selectedImage","setSelectedImage","attachmentCaptions","setAttachmentCaptions","__unstableMarkNextChangeAsNotPersistent","imageSizes","mediaUpload","getMedia","wasBlockJustInserted","__unstableGalleryWithImageBlocks","settings","getSettings","resizedImages","ids","currentResizedImages","id","image","sizes","currentSizes","size","defaultUrl","slug","mediaDetailsUrl","parseInt","onFocusGalleryCaption","setAttributes","newAttrs","Error","onSelectImage","index","onDeselectImage","onMove","oldIndex","newIndex","newImages","splice","onMoveForward","length","onMoveBackward","onRemoveImage","img","i","Math","min","selectCaption","newImage","newImageId","currentImage","currentImageCaption","caption","attachment","onSelectImages","onUploadError","message","removeAllNotices","createErrorNotice","setLinkTo","setColumnsNumber","toggleImageCrop","getImageCropHelp","checked","setImageAttributes","newAttributes","slice","getImagesSizeOptions","name","updateImagesSize","newSizeSlug","updatedImages","url","OS","filesList","onFileChange","allowedTypes","window","wp","media","view","defaultProps","link","hasImages","hasImageIds","mediaPlaceholder","title","instructions","undefined","isUpdateOpen","setUpdateOpen","openUpdateModal","closeUpdateModal","blockProps","imageSizeOptions","shouldShowSizeOptions","isWeb","isNarrow"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tevery,\n\tfilter,\n\tfind,\n\tforEach,\n\tget,\n\tisEmpty,\n\tmap,\n\treduce,\n\tsome,\n\ttoString,\n} from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { compose } from '@wordpress/compose';\nimport {\n\tPanelBody,\n\tSelectControl,\n\tToggleControl,\n\twithNotices,\n\tRangeControl,\n\tToolbarButton,\n} from '@wordpress/components';\nimport {\n\tBlockControls,\n\tMediaPlaceholder,\n\tInspectorControls,\n\tuseBlockProps,\n\tstore as blockEditorStore,\n} from '@wordpress/block-editor';\nimport { Platform, useEffect, useState, useMemo } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport { getBlobByURL, isBlobURL, revokeBlobURL } from '@wordpress/blob';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { withViewportMatch } from '@wordpress/viewport';\nimport { View } from '@wordpress/primitives';\nimport { store as coreStore } from '@wordpress/core-data';\n\n/**\n * Internal dependencies\n */\nimport { sharedIcon } from '../shared-icon';\nimport { pickRelevantMediaFiles } from './shared';\nimport { defaultColumnsNumberV1 } from '../deprecated';\nimport Gallery from './gallery';\nimport {\n\tLINK_DESTINATION_ATTACHMENT,\n\tLINK_DESTINATION_MEDIA,\n\tLINK_DESTINATION_NONE,\n} from './constants';\nimport UpdateGalleryModal from './update-gallery-modal';\n\nconst MAX_COLUMNS = 8;\nconst linkOptions = [\n\t{ value: LINK_DESTINATION_ATTACHMENT, label: __( 'Attachment Page' ) },\n\t{ value: LINK_DESTINATION_MEDIA, label: __( 'Media File' ) },\n\t{ value: LINK_DESTINATION_NONE, label: __( 'None' ) },\n];\nconst ALLOWED_MEDIA_TYPES = [ 'image' ];\n\nconst PLACEHOLDER_TEXT = Platform.select( {\n\tweb: __(\n\t\t'Drag images, upload new ones or select files from your library.'\n\t),\n\tnative: __( 'ADD MEDIA' ),\n} );\n\nconst MOBILE_CONTROL_PROPS_RANGE_CONTROL = Platform.select( {\n\tweb: {},\n\tnative: { type: 'stepper' },\n} );\n\nfunction GalleryEdit( props ) {\n\tconst {\n\t\tattributes,\n\t\tclientId,\n\t\tisSelected,\n\t\tnoticeUI,\n\t\tnoticeOperations,\n\t\tonFocus,\n\t} = props;\n\tconst {\n\t\tcolumns = defaultColumnsNumberV1( attributes ),\n\t\timageCrop,\n\t\timages,\n\t\tlinkTo,\n\t\tsizeSlug,\n\t} = attributes;\n\tconst [ selectedImage, setSelectedImage ] = useState();\n\tconst [ attachmentCaptions, setAttachmentCaptions ] = useState();\n\tconst { __unstableMarkNextChangeAsNotPersistent } = useDispatch(\n\t\tblockEditorStore\n\t);\n\n\tconst {\n\t\timageSizes,\n\t\tmediaUpload,\n\t\tgetMedia,\n\t\twasBlockJustInserted,\n\t\t__unstableGalleryWithImageBlocks,\n\t} = useSelect( ( select ) => {\n\t\tconst settings = select( blockEditorStore ).getSettings();\n\n\t\treturn {\n\t\t\t__unstableGalleryWithImageBlocks:\n\t\t\t\tsettings.__unstableGalleryWithImageBlocks,\n\t\t\timageSizes: settings.imageSizes,\n\t\t\tmediaUpload: settings.mediaUpload,\n\t\t\tgetMedia: select( coreStore ).getMedia,\n\t\t\twasBlockJustInserted: select(\n\t\t\t\tblockEditorStore\n\t\t\t).wasBlockJustInserted( clientId, 'inserter_menu' ),\n\t\t};\n\t} );\n\n\tconst resizedImages = useMemo( () => {\n\t\tif ( isSelected ) {\n\t\t\treturn reduce(\n\t\t\t\tattributes.ids,\n\t\t\t\t( currentResizedImages, id ) => {\n\t\t\t\t\tif ( ! id ) {\n\t\t\t\t\t\treturn currentResizedImages;\n\t\t\t\t\t}\n\t\t\t\t\tconst image = getMedia( id );\n\t\t\t\t\tconst sizes = reduce(\n\t\t\t\t\t\timageSizes,\n\t\t\t\t\t\t( currentSizes, size ) => {\n\t\t\t\t\t\t\tconst defaultUrl = get( image, [\n\t\t\t\t\t\t\t\t'sizes',\n\t\t\t\t\t\t\t\tsize.slug,\n\t\t\t\t\t\t\t\t'url',\n\t\t\t\t\t\t\t] );\n\t\t\t\t\t\t\tconst mediaDetailsUrl = get( image, [\n\t\t\t\t\t\t\t\t'media_details',\n\t\t\t\t\t\t\t\t'sizes',\n\t\t\t\t\t\t\t\tsize.slug,\n\t\t\t\t\t\t\t\t'source_url',\n\t\t\t\t\t\t\t] );\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t...currentSizes,\n\t\t\t\t\t\t\t\t[ size.slug ]: defaultUrl || mediaDetailsUrl,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{}\n\t\t\t\t\t);\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...currentResizedImages,\n\t\t\t\t\t\t[ parseInt( id, 10 ) ]: sizes,\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\t{}\n\t\t\t);\n\t\t}\n\t\treturn {};\n\t}, [ isSelected, attributes.ids, imageSizes ] );\n\n\tfunction onFocusGalleryCaption() {\n\t\tsetSelectedImage();\n\t}\n\n\tfunction setAttributes( newAttrs ) {\n\t\tif ( newAttrs.ids ) {\n\t\t\tthrow new Error(\n\t\t\t\t'The \"ids\" attribute should not be changed directly. It is managed automatically when \"images\" attribute changes'\n\t\t\t);\n\t\t}\n\n\t\tif ( newAttrs.images ) {\n\t\t\tnewAttrs = {\n\t\t\t\t...newAttrs,\n\t\t\t\t// Unlike images[ n ].id which is a string, always ensure the\n\t\t\t\t// ids array contains numbers as per its attribute type.\n\t\t\t\tids: map( newAttrs.images, ( { id } ) => parseInt( id, 10 ) ),\n\t\t\t};\n\t\t}\n\n\t\tprops.setAttributes( newAttrs );\n\t}\n\n\tfunction onSelectImage( index ) {\n\t\treturn () => {\n\t\t\tsetSelectedImage( index );\n\t\t};\n\t}\n\n\tfunction onDeselectImage() {\n\t\treturn () => {\n\t\t\tsetSelectedImage();\n\t\t};\n\t}\n\n\tfunction onMove( oldIndex, newIndex ) {\n\t\tconst newImages = [ ...images ];\n\t\tnewImages.splice( newIndex, 1, images[ oldIndex ] );\n\t\tnewImages.splice( oldIndex, 1, images[ newIndex ] );\n\t\tsetSelectedImage( newIndex );\n\t\tsetAttributes( { images: newImages } );\n\t}\n\n\tfunction onMoveForward( oldIndex ) {\n\t\treturn () => {\n\t\t\tif ( oldIndex === images.length - 1 ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tonMove( oldIndex, oldIndex + 1 );\n\t\t};\n\t}\n\n\tfunction onMoveBackward( oldIndex ) {\n\t\treturn () => {\n\t\t\tif ( oldIndex === 0 ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tonMove( oldIndex, oldIndex - 1 );\n\t\t};\n\t}\n\n\tfunction onRemoveImage( index ) {\n\t\treturn () => {\n\t\t\tconst newImages = filter( images, ( img, i ) => index !== i );\n\t\t\tsetSelectedImage();\n\t\t\tsetAttributes( {\n\t\t\t\timages: newImages,\n\t\t\t\tcolumns: attributes.columns\n\t\t\t\t\t? Math.min( newImages.length, attributes.columns )\n\t\t\t\t\t: attributes.columns,\n\t\t\t} );\n\t\t};\n\t}\n\n\tfunction selectCaption( newImage ) {\n\t\t// The image id in both the images and attachmentCaptions arrays is a\n\t\t// string, so ensure comparison works correctly by converting the\n\t\t// newImage.id to a string.\n\t\tconst newImageId = toString( newImage.id );\n\t\tconst currentImage = find( images, { id: newImageId } );\n\t\tconst currentImageCaption = currentImage\n\t\t\t? currentImage.caption\n\t\t\t: newImage.caption;\n\n\t\tif ( ! attachmentCaptions ) {\n\t\t\treturn currentImageCaption;\n\t\t}\n\n\t\tconst attachment = find( attachmentCaptions, {\n\t\t\tid: newImageId,\n\t\t} );\n\n\t\t// if the attachment caption is updated\n\t\tif ( attachment && attachment.caption !== newImage.caption ) {\n\t\t\treturn newImage.caption;\n\t\t}\n\n\t\treturn currentImageCaption;\n\t}\n\n\tfunction onSelectImages( newImages ) {\n\t\tsetAttachmentCaptions(\n\t\t\tnewImages.map( ( newImage ) => ( {\n\t\t\t\t// Store the attachmentCaption id as a string for consistency\n\t\t\t\t// with the type of the id in the images attribute.\n\t\t\t\tid: toString( newImage.id ),\n\t\t\t\tcaption: newImage.caption,\n\t\t\t} ) )\n\t\t);\n\t\tsetAttributes( {\n\t\t\timages: newImages.map( ( newImage ) => ( {\n\t\t\t\t...pickRelevantMediaFiles( newImage, sizeSlug ),\n\t\t\t\tcaption: selectCaption( newImage, images, attachmentCaptions ),\n\t\t\t\t// The id value is stored in a data attribute, so when the\n\t\t\t\t// block is parsed it's converted to a string. Converting\n\t\t\t\t// to a string here ensures it's type is consistent.\n\t\t\t\tid: toString( newImage.id ),\n\t\t\t} ) ),\n\t\t\tcolumns: attributes.columns\n\t\t\t\t? Math.min( newImages.length, attributes.columns )\n\t\t\t\t: attributes.columns,\n\t\t} );\n\t}\n\n\tfunction onUploadError( message ) {\n\t\tnoticeOperations.removeAllNotices();\n\t\tnoticeOperations.createErrorNotice( message );\n\t}\n\n\tfunction setLinkTo( value ) {\n\t\tsetAttributes( { linkTo: value } );\n\t}\n\n\tfunction setColumnsNumber( value ) {\n\t\tsetAttributes( { columns: value } );\n\t}\n\n\tfunction toggleImageCrop() {\n\t\tsetAttributes( { imageCrop: ! imageCrop } );\n\t}\n\n\tfunction getImageCropHelp( checked ) {\n\t\treturn checked\n\t\t\t? __( 'Thumbnails are cropped to align.' )\n\t\t\t: __( 'Thumbnails are not cropped.' );\n\t}\n\n\tfunction setImageAttributes( index, newAttributes ) {\n\t\tif ( ! images[ index ] ) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetAttributes( {\n\t\t\timages: [\n\t\t\t\t...images.slice( 0, index ),\n\t\t\t\t{\n\t\t\t\t\t...images[ index ],\n\t\t\t\t\t...newAttributes,\n\t\t\t\t},\n\t\t\t\t...images.slice( index + 1 ),\n\t\t\t],\n\t\t} );\n\t}\n\n\tfunction getImagesSizeOptions() {\n\t\treturn map(\n\t\t\tfilter( imageSizes, ( { slug } ) =>\n\t\t\t\tsome( resizedImages, ( sizes ) => sizes[ slug ] )\n\t\t\t),\n\t\t\t( { name, slug } ) => ( { value: slug, label: name } )\n\t\t);\n\t}\n\n\tfunction updateImagesSize( newSizeSlug ) {\n\t\tconst updatedImages = map( images, ( image ) => {\n\t\t\tif ( ! image.id ) {\n\t\t\t\treturn image;\n\t\t\t}\n\t\t\tconst url = get( resizedImages, [\n\t\t\t\tparseInt( image.id, 10 ),\n\t\t\t\tnewSizeSlug,\n\t\t\t] );\n\t\t\treturn {\n\t\t\t\t...image,\n\t\t\t\t...( url && { url } ),\n\t\t\t};\n\t\t} );\n\n\t\tsetAttributes( { images: updatedImages, sizeSlug: newSizeSlug } );\n\t}\n\n\tuseEffect( () => {\n\t\tif (\n\t\t\tPlatform.OS === 'web' &&\n\t\t\timages &&\n\t\t\timages.length > 0 &&\n\t\t\tevery( images, ( { url } ) => isBlobURL( url ) )\n\t\t) {\n\t\t\tconst filesList = map( images, ( { url } ) => getBlobByURL( url ) );\n\t\t\tforEach( images, ( { url } ) => revokeBlobURL( url ) );\n\t\t\tmediaUpload( {\n\t\t\t\tfilesList,\n\t\t\t\tonFileChange: onSelectImages,\n\t\t\t\tallowedTypes: [ 'image' ],\n\t\t\t} );\n\t\t}\n\t}, [] );\n\n\tuseEffect( () => {\n\t\t// Deselect images when deselecting the block\n\t\tif ( ! isSelected ) {\n\t\t\tsetSelectedImage();\n\t\t}\n\t}, [ isSelected ] );\n\n\tuseEffect( () => {\n\t\t// linkTo attribute must be saved so blocks don't break when changing\n\t\t// image_default_link_type in options.php\n\t\tif ( ! linkTo ) {\n\t\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\t\tsetAttributes( {\n\t\t\t\tlinkTo:\n\t\t\t\t\twindow?.wp?.media?.view?.settings?.defaultProps?.link ||\n\t\t\t\t\tLINK_DESTINATION_NONE,\n\t\t\t} );\n\t\t}\n\t}, [ linkTo ] );\n\n\tconst hasImages = !! images.length;\n\tconst hasImageIds = hasImages && images.some( ( image ) => !! image.id );\n\n\tconst mediaPlaceholder = (\n\t\t<MediaPlaceholder\n\t\t\taddToGallery={ hasImageIds }\n\t\t\tisAppender={ hasImages }\n\t\t\tdisableMediaButtons={ hasImages && ! isSelected }\n\t\t\ticon={ ! hasImages && sharedIcon }\n\t\t\tlabels={ {\n\t\t\t\ttitle: ! hasImages && __( 'Gallery' ),\n\t\t\t\tinstructions: ! hasImages && PLACEHOLDER_TEXT,\n\t\t\t} }\n\t\t\tonSelect={ onSelectImages }\n\t\t\taccept=\"image/*\"\n\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\tmultiple\n\t\t\tvalue={ hasImageIds ? images : {} }\n\t\t\tonError={ onUploadError }\n\t\t\tnotices={ hasImages ? undefined : noticeUI }\n\t\t\tonFocus={ onFocus }\n\t\t\tautoOpenMediaUpload={\n\t\t\t\t! hasImages && isSelected && wasBlockJustInserted\n\t\t\t}\n\t\t/>\n\t);\n\n\tconst [ isUpdateOpen, setUpdateOpen ] = useState( false );\n\tconst openUpdateModal = () => setUpdateOpen( true );\n\tconst closeUpdateModal = () => setUpdateOpen( false );\n\n\tconst blockProps = useBlockProps();\n\n\tif ( ! hasImages ) {\n\t\treturn <View { ...blockProps }>{ mediaPlaceholder }</View>;\n\t}\n\n\tconst imageSizeOptions = getImagesSizeOptions();\n\tconst shouldShowSizeOptions = hasImages && ! isEmpty( imageSizeOptions );\n\n\treturn (\n\t\t<>\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'Gallery settings' ) }>\n\t\t\t\t\t{ images.length > 1 && (\n\t\t\t\t\t\t<RangeControl\n\t\t\t\t\t\t\tlabel={ __( 'Columns' ) }\n\t\t\t\t\t\t\tvalue={ columns }\n\t\t\t\t\t\t\tonChange={ setColumnsNumber }\n\t\t\t\t\t\t\tmin={ 1 }\n\t\t\t\t\t\t\tmax={ Math.min( MAX_COLUMNS, images.length ) }\n\t\t\t\t\t\t\t{ ...MOBILE_CONTROL_PROPS_RANGE_CONTROL }\n\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\tlabel={ __( 'Crop images' ) }\n\t\t\t\t\t\tchecked={ !! imageCrop }\n\t\t\t\t\t\tonChange={ toggleImageCrop }\n\t\t\t\t\t\thelp={ getImageCropHelp }\n\t\t\t\t\t/>\n\t\t\t\t\t<SelectControl\n\t\t\t\t\t\tlabel={ __( 'Link to' ) }\n\t\t\t\t\t\tvalue={ linkTo }\n\t\t\t\t\t\tonChange={ setLinkTo }\n\t\t\t\t\t\toptions={ linkOptions }\n\t\t\t\t\t\thideCancelButton={ true }\n\t\t\t\t\t/>\n\t\t\t\t\t{ shouldShowSizeOptions && (\n\t\t\t\t\t\t<SelectControl\n\t\t\t\t\t\t\tlabel={ __( 'Image size' ) }\n\t\t\t\t\t\t\tvalue={ sizeSlug }\n\t\t\t\t\t\t\toptions={ imageSizeOptions }\n\t\t\t\t\t\t\tonChange={ updateImagesSize }\n\t\t\t\t\t\t\thideCancelButton={ true }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t\t{ /* TODO: Remove platform condition when native conversion is ready */ }\n\t\t\t{ Platform.isWeb && __unstableGalleryWithImageBlocks && (\n\t\t\t\t<BlockControls group=\"other\">\n\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\tonClick={ openUpdateModal }\n\t\t\t\t\t\ttitle={ __( 'Update' ) }\n\t\t\t\t\t\tlabel={ __( 'Update to the new gallery format' ) }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ __( 'Update' ) }\n\t\t\t\t\t</ToolbarButton>\n\t\t\t\t</BlockControls>\n\t\t\t) }\n\t\t\t{ Platform.isWeb && isUpdateOpen && (\n\t\t\t\t<UpdateGalleryModal\n\t\t\t\t\tonClose={ closeUpdateModal }\n\t\t\t\t\tclientId={ clientId }\n\t\t\t\t/>\n\t\t\t) }\n\t\t\t{ noticeUI }\n\t\t\t<Gallery\n\t\t\t\t{ ...props }\n\t\t\t\tselectedImage={ selectedImage }\n\t\t\t\tmediaPlaceholder={ mediaPlaceholder }\n\t\t\t\tonMoveBackward={ onMoveBackward }\n\t\t\t\tonMoveForward={ onMoveForward }\n\t\t\t\tonRemoveImage={ onRemoveImage }\n\t\t\t\tonSelectImage={ onSelectImage }\n\t\t\t\tonDeselectImage={ onDeselectImage }\n\t\t\t\tonSetImageAttributes={ setImageAttributes }\n\t\t\t\tblockProps={ blockProps }\n\t\t\t\t// This prop is used by gallery.native.js.\n\t\t\t\tonFocusGalleryCaption={ onFocusGalleryCaption }\n\t\t\t/>\n\t\t</>\n\t);\n}\n\nexport default compose( [\n\twithNotices,\n\twithViewportMatch( { isNarrow: '< small' } ),\n] )( GalleryEdit );\n"]}