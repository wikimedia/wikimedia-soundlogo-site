{"version":3,"sources":["@wordpress/block-library/src/post-featured-image/edit.js"],"names":["useEntityProp","store","coreStore","useSelect","Icon","ToggleControl","PanelBody","withNotices","InspectorControls","BlockControls","MediaPlaceholder","MediaReplaceFlow","BlockIcon","useBlockProps","__","sprintf","postFeaturedImage","DimensionControls","ALLOWED_MEDIA_TYPES","placeholderChip","PostFeaturedImageDisplay","attributes","setAttributes","context","postId","postType","queryId","noticeUI","noticeOperations","isDescendentOfQueryLoop","isLink","height","width","scale","featuredImage","setFeaturedImage","media","select","getMedia","blockProps","style","onSelectImage","value","id","onUploadError","message","removeAllNotices","createErrorNotice","image","title","instructions","source_url","alt_text","objectFit","PostFeaturedImageWithNotices","PostFeaturedImageEdit","props"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useEntityProp, store as coreStore } from '@wordpress/core-data';\nimport { useSelect } from '@wordpress/data';\nimport {\n\tIcon,\n\tToggleControl,\n\tPanelBody,\n\twithNotices,\n} from '@wordpress/components';\nimport {\n\tInspectorControls,\n\tBlockControls,\n\tMediaPlaceholder,\n\tMediaReplaceFlow,\n\tBlockIcon,\n\tuseBlockProps,\n} from '@wordpress/block-editor';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { postFeaturedImage } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport DimensionControls from './dimension-controls';\n\nconst ALLOWED_MEDIA_TYPES = [ 'image' ];\nconst placeholderChip = (\n\t<div className=\"post-featured-image_placeholder\">\n\t\t<Icon icon={ postFeaturedImage } />\n\t\t<p> { __( 'Featured Image' ) }</p>\n\t</div>\n);\n\nfunction PostFeaturedImageDisplay( {\n\tattributes,\n\tsetAttributes,\n\tcontext: { postId, postType, queryId },\n\tnoticeUI,\n\tnoticeOperations,\n} ) {\n\tconst isDescendentOfQueryLoop = !! queryId;\n\tconst { isLink, height, width, scale } = attributes;\n\tconst [ featuredImage, setFeaturedImage ] = useEntityProp(\n\t\t'postType',\n\t\tpostType,\n\t\t'featured_media',\n\t\tpostId\n\t);\n\tconst media = useSelect(\n\t\t( select ) =>\n\t\t\tfeaturedImage &&\n\t\t\tselect( coreStore ).getMedia( featuredImage, { context: 'view' } ),\n\t\t[ featuredImage ]\n\t);\n\tconst blockProps = useBlockProps( {\n\t\tstyle: { width },\n\t} );\n\tconst onSelectImage = ( value ) => {\n\t\tif ( value?.id ) {\n\t\t\tsetFeaturedImage( value.id );\n\t\t}\n\t};\n\tfunction onUploadError( message ) {\n\t\tnoticeOperations.removeAllNotices();\n\t\tnoticeOperations.createErrorNotice( message );\n\t}\n\tlet image;\n\tif ( ! featuredImage && isDescendentOfQueryLoop ) {\n\t\treturn <div { ...blockProps }>{ placeholderChip }</div>;\n\t}\n\tif ( ! featuredImage ) {\n\t\timage = (\n\t\t\t<MediaPlaceholder\n\t\t\t\ticon={ <BlockIcon icon={ postFeaturedImage } /> }\n\t\t\t\tonSelect={ onSelectImage }\n\t\t\t\tnotices={ noticeUI }\n\t\t\t\tonError={ onUploadError }\n\t\t\t\taccept=\"image/*\"\n\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\tlabels={ {\n\t\t\t\t\ttitle: __( 'Featured image' ),\n\t\t\t\t\tinstructions: __(\n\t\t\t\t\t\t'Upload a media file or pick one from your media library.'\n\t\t\t\t\t),\n\t\t\t\t} }\n\t\t\t/>\n\t\t);\n\t} else {\n\t\t// We have a Featured image so show a Placeholder if is loading.\n\t\timage = ! media ? (\n\t\t\tplaceholderChip\n\t\t) : (\n\t\t\t<img\n\t\t\t\tsrc={ media.source_url }\n\t\t\t\talt={ media.alt_text || __( 'Featured image' ) }\n\t\t\t\tstyle={ { height, objectFit: height && scale } }\n\t\t\t/>\n\t\t);\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<InspectorControls>\n\t\t\t\t<DimensionControls\n\t\t\t\t\tattributes={ attributes }\n\t\t\t\t\tsetAttributes={ setAttributes }\n\t\t\t\t/>\n\t\t\t\t<PanelBody title={ __( 'Link settings' ) }>\n\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\tlabel={ sprintf(\n\t\t\t\t\t\t\t// translators: %s: Name of the post type e.g: \"post\".\n\t\t\t\t\t\t\t__( 'Link to %s' ),\n\t\t\t\t\t\t\tpostType\n\t\t\t\t\t\t) }\n\t\t\t\t\t\tonChange={ () => setAttributes( { isLink: ! isLink } ) }\n\t\t\t\t\t\tchecked={ isLink }\n\t\t\t\t\t/>\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t\t{ !! media && ! isDescendentOfQueryLoop && (\n\t\t\t\t<BlockControls group=\"other\">\n\t\t\t\t\t<MediaReplaceFlow\n\t\t\t\t\t\tmediaId={ featuredImage }\n\t\t\t\t\t\tmediaURL={ media.source_url }\n\t\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\t\t\taccept=\"image/*\"\n\t\t\t\t\t\tonSelect={ onSelectImage }\n\t\t\t\t\t\tonError={ onUploadError }\n\t\t\t\t\t/>\n\t\t\t\t</BlockControls>\n\t\t\t) }\n\t\t\t<figure { ...blockProps }>{ image }</figure>\n\t\t</>\n\t);\n}\n\nconst PostFeaturedImageWithNotices = withNotices( PostFeaturedImageDisplay );\n\nexport default function PostFeaturedImageEdit( props ) {\n\tconst blockProps = useBlockProps();\n\tif ( ! props.context?.postId ) {\n\t\treturn <div { ...blockProps }>{ placeholderChip }</div>;\n\t}\n\treturn <PostFeaturedImageWithNotices { ...props } />;\n}\n"]}