{"version":3,"sources":["@wordpress/edit-post/src/components/editor-initialization/listener-hooks.js"],"names":["useSelect","useDispatch","useEffect","useRef","store","blockEditorStore","editorStore","STORE_NAME","VIEW_AS_LINK_SELECTOR","VIEW_AS_PREVIEW_LINK_SELECTOR","useBlockSelectionListener","postId","hasBlockSelection","isEditorSidebarOpened","select","getBlockSelectionStart","openGeneralSidebar","useUpdatePostLinkListener","newPermalink","getCurrentPost","link","nodeToUpdate","current","document","querySelector","setAttribute"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,SAAT,EAAoBC,WAApB,QAAuC,iBAAvC;AACA,SAASC,SAAT,EAAoBC,MAApB,QAAkC,oBAAlC;AACA,SAASC,KAAK,IAAIC,gBAAlB,QAA0C,yBAA1C;AACA,SAASD,KAAK,IAAIE,WAAlB,QAAqC,mBAArC;AAEA;AACA;AACA;;AACA,SACCC,UADD,EAECC,qBAFD,EAGCC,6BAHD,QAIO,uBAJP;AAMA;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,MAAMC,yBAAyB,GAAKC,MAAF,IAAc;AACtD,QAAM;AAAEC,IAAAA,iBAAF;AAAqBC,IAAAA;AAArB,MAA+Cb,SAAS,CAC3Dc,MAAF,KAAgB;AACfF,IAAAA,iBAAiB,EAAE,CAAC,CAAEE,MAAM,CAC3BT,gBAD2B,CAAN,CAEpBU,sBAFoB,EADP;AAIfF,IAAAA,qBAAqB,EAAEC,MAAM,CAAEP,UAAF,CAAN,CAAqBM,qBAArB;AAJR,GAAhB,CAD6D,EAO7D,CAAEF,MAAF,CAP6D,CAA9D;AAUA,QAAM;AAAEK,IAAAA;AAAF,MAAyBf,WAAW,CAAEM,UAAF,CAA1C;AAEAL,EAAAA,SAAS,CAAE,MAAM;AAChB,QAAK,CAAEW,qBAAP,EAA+B;AAC9B;AACA;;AACD,QAAKD,iBAAL,EAAyB;AACxBI,MAAAA,kBAAkB,CAAE,iBAAF,CAAlB;AACA,KAFD,MAEO;AACNA,MAAAA,kBAAkB,CAAE,oBAAF,CAAlB;AACA;AACD,GATQ,EASN,CAAEJ,iBAAF,EAAqBC,qBAArB,CATM,CAAT;AAUA,CAvBM;AAyBP;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,MAAMI,yBAAyB,GAAKN,MAAF,IAAc;AACtD,QAAM;AAAEO,IAAAA;AAAF,MAAmBlB,SAAS,CAC/Bc,MAAF,KAAgB;AACfI,IAAAA,YAAY,EAAEJ,MAAM,CAAER,WAAF,CAAN,CAAsBa,cAAtB,GAAuCC;AADtC,GAAhB,CADiC,EAIjC,CAAET,MAAF,CAJiC,CAAlC;AAMA,QAAMU,YAAY,GAAGlB,MAAM,EAA3B;AAEAD,EAAAA,SAAS,CAAE,MAAM;AAChBmB,IAAAA,YAAY,CAACC,OAAb,GACCC,QAAQ,CAACC,aAAT,CAAwBf,6BAAxB,KACAc,QAAQ,CAACC,aAAT,CAAwBhB,qBAAxB,CAFD;AAGA,GAJQ,EAIN,CAAEG,MAAF,CAJM,CAAT;AAMAT,EAAAA,SAAS,CAAE,MAAM;AAChB,QAAK,CAAEgB,YAAF,IAAkB,CAAEG,YAAY,CAACC,OAAtC,EAAgD;AAC/C;AACA;;AACDD,IAAAA,YAAY,CAACC,OAAb,CAAqBG,YAArB,CAAmC,MAAnC,EAA2CP,YAA3C;AACA,GALQ,EAKN,CAAEA,YAAF,CALM,CAAT;AAMA,CArBM","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { useEffect, useRef } from '@wordpress/element';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { store as editorStore } from '@wordpress/editor';\n\n/**\n * Internal dependencies\n */\nimport {\n\tSTORE_NAME,\n\tVIEW_AS_LINK_SELECTOR,\n\tVIEW_AS_PREVIEW_LINK_SELECTOR,\n} from '../../store/constants';\n\n/**\n * This listener hook monitors for block selection and triggers the appropriate\n * sidebar state.\n *\n * @param {number} postId The current post id.\n */\nexport const useBlockSelectionListener = ( postId ) => {\n\tconst { hasBlockSelection, isEditorSidebarOpened } = useSelect(\n\t\t( select ) => ( {\n\t\t\thasBlockSelection: !! select(\n\t\t\t\tblockEditorStore\n\t\t\t).getBlockSelectionStart(),\n\t\t\tisEditorSidebarOpened: select( STORE_NAME ).isEditorSidebarOpened(),\n\t\t} ),\n\t\t[ postId ]\n\t);\n\n\tconst { openGeneralSidebar } = useDispatch( STORE_NAME );\n\n\tuseEffect( () => {\n\t\tif ( ! isEditorSidebarOpened ) {\n\t\t\treturn;\n\t\t}\n\t\tif ( hasBlockSelection ) {\n\t\t\topenGeneralSidebar( 'edit-post/block' );\n\t\t} else {\n\t\t\topenGeneralSidebar( 'edit-post/document' );\n\t\t}\n\t}, [ hasBlockSelection, isEditorSidebarOpened ] );\n};\n\n/**\n * This listener hook monitors any change in permalink and updates the view\n * post link in the admin bar.\n *\n * @param {number} postId\n */\nexport const useUpdatePostLinkListener = ( postId ) => {\n\tconst { newPermalink } = useSelect(\n\t\t( select ) => ( {\n\t\t\tnewPermalink: select( editorStore ).getCurrentPost().link,\n\t\t} ),\n\t\t[ postId ]\n\t);\n\tconst nodeToUpdate = useRef();\n\n\tuseEffect( () => {\n\t\tnodeToUpdate.current =\n\t\t\tdocument.querySelector( VIEW_AS_PREVIEW_LINK_SELECTOR ) ||\n\t\t\tdocument.querySelector( VIEW_AS_LINK_SELECTOR );\n\t}, [ postId ] );\n\n\tuseEffect( () => {\n\t\tif ( ! newPermalink || ! nodeToUpdate.current ) {\n\t\t\treturn;\n\t\t}\n\t\tnodeToUpdate.current.setAttribute( 'href', newPermalink );\n\t}, [ newPermalink ] );\n};\n"]}