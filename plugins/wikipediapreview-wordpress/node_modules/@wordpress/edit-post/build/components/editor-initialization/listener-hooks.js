"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useUpdatePostLinkListener = exports.useBlockSelectionListener = void 0;

var _data = require("@wordpress/data");

var _element = require("@wordpress/element");

var _blockEditor = require("@wordpress/block-editor");

var _editor = require("@wordpress/editor");

var _constants = require("../../store/constants");

/**
 * WordPress dependencies
 */

/**
 * Internal dependencies
 */

/**
 * This listener hook monitors for block selection and triggers the appropriate
 * sidebar state.
 *
 * @param {number} postId The current post id.
 */
const useBlockSelectionListener = postId => {
  const {
    hasBlockSelection,
    isEditorSidebarOpened
  } = (0, _data.useSelect)(select => ({
    hasBlockSelection: !!select(_blockEditor.store).getBlockSelectionStart(),
    isEditorSidebarOpened: select(_constants.STORE_NAME).isEditorSidebarOpened()
  }), [postId]);
  const {
    openGeneralSidebar
  } = (0, _data.useDispatch)(_constants.STORE_NAME);
  (0, _element.useEffect)(() => {
    if (!isEditorSidebarOpened) {
      return;
    }

    if (hasBlockSelection) {
      openGeneralSidebar('edit-post/block');
    } else {
      openGeneralSidebar('edit-post/document');
    }
  }, [hasBlockSelection, isEditorSidebarOpened]);
};
/**
 * This listener hook monitors any change in permalink and updates the view
 * post link in the admin bar.
 *
 * @param {number} postId
 */


exports.useBlockSelectionListener = useBlockSelectionListener;

const useUpdatePostLinkListener = postId => {
  const {
    newPermalink
  } = (0, _data.useSelect)(select => ({
    newPermalink: select(_editor.store).getCurrentPost().link
  }), [postId]);
  const nodeToUpdate = (0, _element.useRef)();
  (0, _element.useEffect)(() => {
    nodeToUpdate.current = document.querySelector(_constants.VIEW_AS_PREVIEW_LINK_SELECTOR) || document.querySelector(_constants.VIEW_AS_LINK_SELECTOR);
  }, [postId]);
  (0, _element.useEffect)(() => {
    if (!newPermalink || !nodeToUpdate.current) {
      return;
    }

    nodeToUpdate.current.setAttribute('href', newPermalink);
  }, [newPermalink]);
};

exports.useUpdatePostLinkListener = useUpdatePostLinkListener;
//# sourceMappingURL=listener-hooks.js.map