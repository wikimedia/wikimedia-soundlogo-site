{"version":3,"sources":["@wordpress/viewport/src/listener.js"],"names":["reduce","forEach","debounce","mapValues","dispatch","store","addDimensionsEventListener","breakpoints","operators","setIsMatching","values","queries","query","matches","leading","result","width","name","condition","operator","list","window","matchMedia","addListener","key","join","addEventListener","flush"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,MAAT,EAAiBC,OAAjB,EAA0BC,QAA1B,EAAoCC,SAApC,QAAqD,QAArD;AAEA;AACA;AACA;;AACA,SAASC,QAAT,QAAyB,iBAAzB;AAEA;AACA;AACA;;AACA,SAASC,KAAT,QAAsB,SAAtB;;AAEA,MAAMC,0BAA0B,GAAG,CAAEC,WAAF,EAAeC,SAAf,KAA8B;AAChE;AACD;AACA;AACA;AACC,QAAMC,aAAa,GAAGP,QAAQ,CAC7B,MAAM;AACL,UAAMQ,MAAM,GAAGP,SAAS,CAAEQ,OAAF,EAAaC,KAAF,IAAaA,KAAK,CAACC,OAA9B,CAAxB;AACAT,IAAAA,QAAQ,CAAEC,KAAF,CAAR,CAAkBI,aAAlB,CAAiCC,MAAjC;AACA,GAJ4B,EAK7B;AAAEI,IAAAA,OAAO,EAAE;AAAX,GAL6B,CAA9B;AAQA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACC,QAAMH,OAAO,GAAGX,MAAM,CACrBO,WADqB,EAErB,CAAEQ,MAAF,EAAUC,KAAV,EAAiBC,IAAjB,KAA2B;AAC1BhB,IAAAA,OAAO,CAAEO,SAAF,EAAa,CAAEU,SAAF,EAAaC,QAAb,KAA2B;AAC9C,YAAMC,IAAI,GAAGC,MAAM,CAACC,UAAP,CACX,IAAIJ,SAAW,KAAKF,KAAO,KADhB,CAAb;AAGAI,MAAAA,IAAI,CAACG,WAAL,CAAkBd,aAAlB;AAEA,YAAMe,GAAG,GAAG,CAAEL,QAAF,EAAYF,IAAZ,EAAmBQ,IAAnB,CAAyB,GAAzB,CAAZ;AACAV,MAAAA,MAAM,CAAES,GAAF,CAAN,GAAgBJ,IAAhB;AACA,KARM,CAAP;AAUA,WAAOL,MAAP;AACA,GAdoB,EAerB,EAfqB,CAAtB;AAkBAM,EAAAA,MAAM,CAACK,gBAAP,CAAyB,mBAAzB,EAA8CjB,aAA9C,EAxCgE,CA0ChE;;AACAA,EAAAA,aAAa;AACbA,EAAAA,aAAa,CAACkB,KAAd;AACA,CA7CD;;AA+CA,eAAerB,0BAAf","sourcesContent":["/**\n * External dependencies\n */\nimport { reduce, forEach, debounce, mapValues } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { dispatch } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport { store } from './store';\n\nconst addDimensionsEventListener = ( breakpoints, operators ) => {\n\t/**\n\t * Callback invoked when media query state should be updated. Is invoked a\n\t * maximum of one time per call stack.\n\t */\n\tconst setIsMatching = debounce(\n\t\t() => {\n\t\t\tconst values = mapValues( queries, ( query ) => query.matches );\n\t\t\tdispatch( store ).setIsMatching( values );\n\t\t},\n\t\t{ leading: true }\n\t);\n\n\t/**\n\t * Hash of breakpoint names with generated MediaQueryList for corresponding\n\t * media query.\n\t *\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/matchMedia\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/MediaQueryList\n\t *\n\t * @type {Object<string,MediaQueryList>}\n\t */\n\tconst queries = reduce(\n\t\tbreakpoints,\n\t\t( result, width, name ) => {\n\t\t\tforEach( operators, ( condition, operator ) => {\n\t\t\t\tconst list = window.matchMedia(\n\t\t\t\t\t`(${ condition }: ${ width }px)`\n\t\t\t\t);\n\t\t\t\tlist.addListener( setIsMatching );\n\n\t\t\t\tconst key = [ operator, name ].join( ' ' );\n\t\t\t\tresult[ key ] = list;\n\t\t\t} );\n\n\t\t\treturn result;\n\t\t},\n\t\t{}\n\t);\n\n\twindow.addEventListener( 'orientationchange', setIsMatching );\n\n\t// Set initial values\n\tsetIsMatching();\n\tsetIsMatching.flush();\n};\n\nexport default addDimensionsEventListener;\n"]}